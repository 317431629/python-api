



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>shotgun_api3.shotgun &mdash; python-api sphinx documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="python-api sphinx documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
    
        <img style='width: 191px;
                height: 60px;
                border-radius: 0px;
                padding: 0px;'
            src='./_static/logo_sg@2x.png'/>
    
    

          
            <a href="../../index.html" class="icon icon-home"> python-api
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Developer Reference</a></li>
</ul>

            
          
       
    <div style='margin-top: 50px;
                margin-left: 10px;
                margin-right: 10px;
                padding: 10px; 
                color: #b3b3b3; 
                font-size: 70%;
                border-radius: 3px;
                background-color: #444;
                line-height: 18px;
                '>    
    <style>
        a.custom_post_menu { display: inline; 
                             padding: 0px; 
                             text-decoration: underline; }
    </style>

    <b>python-api</b> sphinx.<br>
    
    For more information, please visit
    <a class=custom_post_menu href='https://support.shotgunsoftware.com/home'>Shotgun Support</a>.
    The code associated with this documentation can be found 
    <a class=custom_post_menu href='https://github.com/shotgunsoftware/python-api'>here</a>.

    </div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">python-api</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>shotgun_api3.shotgun</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for shotgun_api3.shotgun</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"> Copyright (c) 2009-2015, Shotgun Software Inc</span>

<span class="sd"> Redistribution and use in source and binary forms, with or without</span>
<span class="sd"> modification, are permitted provided that the following conditions are met:</span>

<span class="sd">  - Redistributions of source code must retain the above copyright notice, this</span>
<span class="sd">    list of conditions and the following disclaimer.</span>

<span class="sd">  - Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="sd">    this list of conditions and the following disclaimer in the documentation</span>
<span class="sd">    and/or other materials provided with the distribution.</span>

<span class="sd">  - Neither the name of the Shotgun Software Inc nor the names of its</span>
<span class="sd">    contributors may be used to endorse or promote products derived from this</span>
<span class="sd">    software without specific prior written permission.</span>

<span class="sd"> THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="sd"> AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="sd"> IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="sd"> DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span>
<span class="sd"> FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="sd"> DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="sd"> SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="sd"> CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<span class="sd"> OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="sd"> OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">cookielib</span>    <span class="c"># used for attachment upload</span>
<span class="kn">import</span> <span class="nn">cStringIO</span>    <span class="c"># used for attachment upload</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">mimetools</span>    <span class="c"># used for attachment upload</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">stat</span>         <span class="c"># used for attachment upload</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">urllib2</span>      <span class="c"># used for image upload</span>
<span class="kn">import</span> <span class="nn">urlparse</span>
<span class="kn">import</span> <span class="nn">shutil</span>       <span class="c"># used for attachment download</span>

<span class="c"># use relative import for versions &gt;=2.5 and package import for python versions &lt;2.5</span>
<span class="k">if</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">sg_26</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">elif</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">sg_25</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sg_24</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c"># mimetypes imported in version specific imports</span>
<span class="n">mimetypes</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s">&#39;video/webm&#39;</span><span class="p">,</span><span class="s">&#39;.webm&#39;</span><span class="p">)</span> <span class="c"># webm and mp4 seem to be missing</span>
<span class="n">mimetypes</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s">&#39;video/mp4&#39;</span><span class="p">,</span> <span class="s">&#39;.mp4&#39;</span><span class="p">)</span>  <span class="c"># from some OS/distros</span>

<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;shotgun_api3&quot;</span><span class="p">)</span>
<span class="n">LOG</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARN</span><span class="p">)</span>


<span class="n">SG_TIMEZONE</span> <span class="o">=</span> <span class="n">SgTimezone</span><span class="p">()</span>


<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ssl</span>
    <span class="n">NO_SSL_VALIDATION</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ssl not found, disabling certificate validation&quot;</span><span class="p">)</span>
    <span class="n">NO_SSL_VALIDATION</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c"># ----------------------------------------------------------------------------</span>
<span class="c"># Version</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;3.0.24.dev&quot;</span>

<span class="c"># ----------------------------------------------------------------------------</span>
<span class="c"># Errors</span>

<div class="viewcode-block" id="ShotgunError"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.ShotgunError">[docs]</a><span class="k">class</span> <span class="nc">ShotgunError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base for all Shotgun API Errors&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="ShotgunFileDownloadError"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.ShotgunFileDownloadError">[docs]</a><span class="k">class</span> <span class="nc">ShotgunFileDownloadError</span><span class="p">(</span><span class="n">ShotgunError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception for file download-related errors&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Fault"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Fault">[docs]</a><span class="k">class</span> <span class="nc">Fault</span><span class="p">(</span><span class="n">ShotgunError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception when server side exception detected.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AuthenticationFault"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.AuthenticationFault">[docs]</a><span class="k">class</span> <span class="nc">AuthenticationFault</span><span class="p">(</span><span class="n">Fault</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception when the server side reports an error related to authentication&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="MissingTwoFactorAuthenticationFault"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.MissingTwoFactorAuthenticationFault">[docs]</a><span class="k">class</span> <span class="nc">MissingTwoFactorAuthenticationFault</span><span class="p">(</span><span class="n">Fault</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception when the server side reports an error related to missing</span>
<span class="sd">    two factor authentication credentials</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="c"># ----------------------------------------------------------------------------</span>
<span class="c"># API</span>
</div>
<div class="viewcode-block" id="ServerCapabilities"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.ServerCapabilities">[docs]</a><span class="k">class</span> <span class="nc">ServerCapabilities</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Container for the servers capabilities, such as version and paging.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ServerCapabilities.__init__</span>

<span class="sd">        :param host: Host name for the server excluding protocol.</span>

<span class="sd">        :param meta: dict of meta data for the server returned from the</span>
<span class="sd">            info api method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#Server host name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_info</span> <span class="o">=</span> <span class="n">meta</span>

        <span class="c">#Version from server is major.minor.rev or major.minor.rev.&quot;Dev&quot;</span>
        <span class="c">#Store version as triple and check dev flag</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;The Shotgun Server didn&#39;t respond with a version number. &quot;</span>
                               <span class="s">&quot;This may be because you are running an older version of &quot;</span>
                               <span class="s">&quot;Shotgun against a more recent version of the Shotgun API. &quot;</span>
                               <span class="s">&quot;For more information, please contact Shotgun Support.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;Dev&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_dev</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_dev</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_json_supported</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_ensure_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">raise_hell</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks the server version supports a given feature, raises an</span>
<span class="sd">        exception if it does not.</span>

<span class="sd">        :param feature: dict supported version and human label { &#39;version&#39;: (int, int, int), &#39;label&#39;: str }</span>

<span class="sd">        :raises ShotgunError: The current server version does not [feature]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="n">feature</span><span class="p">[</span><span class="s">&#39;version&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">raise_hell</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span>
                    <span class="s">&quot;</span><span class="si">%s</span><span class="s"> requires server version </span><span class="si">%s</span><span class="s"> or higher, &quot;</span>\
                    <span class="s">&quot;server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">],</span> <span class="n">_version_str</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s">&#39;version&#39;</span><span class="p">]),</span> <span class="n">_version_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>


    <span class="k">def</span> <span class="nf">_ensure_json_supported</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for ensure_support&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_support</span><span class="p">({</span>
            <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s">&#39;label&#39;</span><span class="p">:</span> <span class="s">&#39;JSON API&#39;</span>
        <span class="p">})</span>

<div class="viewcode-block" id="ServerCapabilities.ensure_include_archived_projects"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.ServerCapabilities.ensure_include_archived_projects">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_include_archived_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for ensure_support&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_support</span><span class="p">({</span>
            <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
            <span class="s">&#39;label&#39;</span><span class="p">:</span> <span class="s">&#39;include_archived_projects parameter&#39;</span>
        <span class="p">})</span>
</div>
<div class="viewcode-block" id="ServerCapabilities.ensure_per_project_customization"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.ServerCapabilities.ensure_per_project_customization">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_per_project_customization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for ensure_support&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_support</span><span class="p">({</span>
            <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="s">&#39;label&#39;</span><span class="p">:</span> <span class="s">&#39;project parameter&#39;</span>
        <span class="p">},</span> <span class="bp">True</span><span class="p">)</span>

</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;ServerCapabilities: host </span><span class="si">%s</span><span class="s">, version </span><span class="si">%s</span><span class="s">, is_dev </span><span class="si">%s</span><span class="s">&quot;</span>\
                 <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dev</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ClientCapabilities"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.ClientCapabilities">[docs]</a><span class="k">class</span> <span class="nc">ClientCapabilities</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Container for the client capabilities.</span>

<span class="sd">    Detects the current client platform and works out the SG field</span>
<span class="sd">    used for local data paths.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;darwin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s">&quot;mac&quot;</span>
        <span class="k">elif</span> <span class="n">system</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;linux&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;linux&#39;</span>
        <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;win32&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;windows&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_path_field</span> <span class="o">=</span> <span class="s">&quot;local_path_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_path_field</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">py_version</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;ClientCapabilities: platform </span><span class="si">%s</span><span class="s">, local_path_field </span><span class="si">%s</span><span class="s">, &quot;</span>\
            <span class="s">&quot;py_verison </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_path_field</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">py_version</span><span class="p">)</span>
</div>
<span class="k">class</span> <span class="nc">_Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Container for the client configuration.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_rpc_attempts</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="c"># From http://docs.python.org/2.6/library/httplib.html:</span>
        <span class="c"># If the optional timeout parameter is given, blocking operations </span>
        <span class="c"># (like connection attempts) will timeout after that many seconds </span>
        <span class="c"># (if it is not given, the global default timeout setting is used)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout_secs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_ver</span> <span class="o">=</span> <span class="s">&#39;api3&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_datetimes_to_utc</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">records_per_page</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sudo_as_login</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># uuid as a string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_uuid</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># The raw_http_proxy reflects the exact string passed in </span>
        <span class="c"># to the Shotgun constructor. This can be useful if you </span>
        <span class="c"># need to construct a Shotgun API instance based on </span>
        <span class="c"># another Shotgun API instance.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_http_proxy</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># if a proxy server is being used, the proxy_handler</span>
        <span class="c"># below will contain a urllib2.ProxyHandler instance</span>
        <span class="c"># which can be used whenever a request needs to be made.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_handler</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_server</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_port</span> <span class="o">=</span> <span class="mi">8080</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_user</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_pass</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_token</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authorization</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_ssl_validation</span> <span class="o">=</span> <span class="bp">False</span>


<div class="viewcode-block" id="Shotgun"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun">[docs]</a><span class="k">class</span> <span class="nc">Shotgun</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shotgun Client Connection&quot;&quot;&quot;</span>

    <span class="c"># reg ex from</span>
    <span class="c"># http://underground.infovark.com/2008/07/22/iso-date-validation-regex/</span>
    <span class="c"># Note a length check is done before checking the reg ex</span>
    <span class="n">_DATE_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s">&quot;^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$&quot;</span><span class="p">)</span>
    <span class="n">_DATE_TIME_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s">&quot;^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])&quot;</span>\
        <span class="s">&quot;(\D?([01]\d|2[0-3])\D?([0-5]\d)\D?([0-5]\d)?\D?(\d{3})?)?$&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">base_url</span><span class="p">,</span>
                 <span class="n">script_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">api_key</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">convert_datetimes_to_utc</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">http_proxy</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">connect</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">ca_certs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">login</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">sudo_as_login</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">session_token</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">auth_token</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes a new instance of the Shotgun client.</span>

<span class="sd">        :param base_url: http or https url to the shotgun server.</span>

<span class="sd">        :param script_name: name of the client script, used to authenticate</span>
<span class="sd">        to the server. If script_name is provided, then api_key must be as</span>
<span class="sd">        well and neither login nor password can be provided.</span>

<span class="sd">        :param api_key: key assigned to the client script, used to</span>
<span class="sd">        authenticate to the server.  If api_key is provided, then script_name</span>
<span class="sd">        must be as well and neither login nor password can be provided.</span>

<span class="sd">        :param convert_datetimes_to_utc: If True date time values are</span>
<span class="sd">        converted from local time to UTC time before been sent to the server.</span>
<span class="sd">        Datetimes received from the server are converted back to local time.</span>
<span class="sd">        If False the client should use UTC date time values.</span>
<span class="sd">        Default is True.</span>

<span class="sd">        :param http_proxy: Optional, URL for the http proxy server, on the</span>
<span class="sd">        form [username:pass@]proxy.com[:8080]</span>

<span class="sd">        :param connect: If True, connect to the server. Only used for testing.</span>
<span class="sd">        </span>
<span class="sd">        :param ca_certs: Optional path to an external SSL certificates file. By </span>
<span class="sd">        default, the Shotgun API will use its own built-in certificates file</span>
<span class="sd">        which stores root certificates for the most common Certificate </span>
<span class="sd">        Authorities (CAs). If you are using a corporate or internal CA, or are</span>
<span class="sd">        packaging an application into an executable, it may be necessary to </span>
<span class="sd">        point to your own certificates file. You can do this by passing in the </span>
<span class="sd">        full path to the file via this parameter or by setting the environment </span>
<span class="sd">        variable `SHOTGUN_API_CACERTS`. In the case both are set, this </span>
<span class="sd">        parameter will take precedence. </span>

<span class="sd">        :param login: The login to use to authenticate to the server. If login</span>
<span class="sd">        is provided, then password must be as well and neither script_name nor</span>
<span class="sd">        api_key can be provided.</span>

<span class="sd">        :param password: The password for the login to use to authenticate to</span>
<span class="sd">        the server. If password is provided, then login must be as well and</span>
<span class="sd">        neither script_name nor api_key can be provided.</span>
<span class="sd">        </span>
<span class="sd">        :param sudo_as_login: A user login string for the user whose permissions will</span>
<span class="sd">        be applied to all actions and who will be logged as the user performing</span>
<span class="sd">        all actions. Note that logged events will have an additional extra meta-data parameter </span>
<span class="sd">        &#39;sudo_actual_user&#39; indicating the script or user that actually authenticated.</span>
<span class="sd">        </span>
<span class="sd">        :param session_token: The session token to use to authenticate to the server. This</span>
<span class="sd">        can be used as an alternative to authenticating with a script user or regular user.</span>
<span class="sd">        You retrieve the session token by running the get_session_token() method.        </span>

<span class="sd">        :param auth_token: The authentication token required to authenticate to</span>
<span class="sd">        a server with two factor authentication turned on. If auth_token is provided,</span>
<span class="sd">        then login and password must be as well and neither script_name nor api_key</span>
<span class="sd">        can be provided. Note that these tokens can be short lived so a session is</span>
<span class="sd">        established right away if an auth_token is provided. A</span>
<span class="sd">        MissingTwoFactorAuthenticationFault will be raised if the auth_token is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># verify authentication arguments</span>
        <span class="k">if</span> <span class="n">session_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">script_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;cannot provide both session_token &quot;</span>
                                 <span class="s">&quot;and script_name/api_key&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">login</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">password</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;cannot provide both session_token &quot;</span>
                                 <span class="s">&quot;and login/password&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">login</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">password</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">script_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;cannot provide both login/password &quot;</span>
                                 <span class="s">&quot;and script_name/api_key&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">login</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;password provided without login&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">password</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;login provided without password&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">script_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">script_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;api_key provided without script_name&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;script_name provided without api_key&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">auth_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">login</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">password</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;must provide a user login and password with an auth_token&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">script_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;cannot provide an auth_code with script_name/api_key&quot;</span><span class="p">)</span>

        <span class="c"># Can&#39;t use &#39;all&#39; with python 2.4</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">session_token</span><span class="p">,</span> <span class="n">script_name</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;must provide login/password, session_token or script_name/api_key&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">_Config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">script_name</span> <span class="o">=</span> <span class="n">script_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="n">login</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">auth_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span> <span class="o">=</span> <span class="n">session_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sudo_as_login</span> <span class="o">=</span> <span class="n">sudo_as_login</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">convert_datetimes_to_utc</span> <span class="o">=</span> <span class="n">convert_datetimes_to_utc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_ssl_validation</span> <span class="o">=</span> <span class="n">NO_SSL_VALIDATION</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">raw_http_proxy</span> <span class="o">=</span> <span class="n">http_proxy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">ca_certs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span> <span class="o">=</span> <span class="n">ca_certs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;SHOTGUN_API_CACERTS&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="p">(</span><span class="n">base_url</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">api_base</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
            <span class="n">urlparse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;http&quot;</span><span class="p">,</span> <span class="s">&quot;https&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;base_url must use http or https got &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">api_path</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">urlparse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span>
            <span class="n">api_base</span> <span class="ow">or</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">api_ver</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span><span class="p">),</span> <span class="s">&quot;json&quot;</span><span class="p">)</span>


        <span class="c"># if the service contains user information strip it out</span>
        <span class="c"># copied from the xmlrpclib which turned the user:password into</span>
        <span class="c"># and auth header</span>
        <span class="n">auth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">splituser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">encodestring</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">auth</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">authorization</span> <span class="o">=</span> <span class="s">&quot;Basic &quot;</span> <span class="o">+</span> <span class="n">auth</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c"># foo:bar@123.456.789.012:3456</span>
        <span class="k">if</span> <span class="n">http_proxy</span><span class="p">:</span>
            <span class="c"># check if we&#39;re using authentication</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">http_proxy</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;@&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_pass</span> <span class="o">=</span> \
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">proxy_server</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proxy_server</span> <span class="o">=</span> <span class="n">http_proxy</span>
            <span class="n">proxy_netloc_list</span> <span class="o">=</span> <span class="n">proxy_server</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_server</span> <span class="o">=</span> <span class="n">proxy_netloc_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">proxy_netloc_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">proxy_netloc_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Invalid http_proxy address &#39;</span><span class="si">%s</span><span class="s">&#39;. Valid &quot;</span> \
                        <span class="s">&quot;format is &#39;123.456.789.012&#39; or &#39;123.456.789.012:3456&#39;&quot;</span>\
                        <span class="s">&quot;. If no port is specified, a default of </span><span class="si">%d</span><span class="s"> will be &quot;</span>\
                        <span class="s">&quot;used.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">http_proxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_port</span><span class="p">))</span>

            <span class="c"># now populate self.config.proxy_handler</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_user</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_pass</span><span class="p">:</span>
                <span class="n">auth_string</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">@&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_pass</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">auth_string</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">proxy_addr</span> <span class="o">=</span> <span class="s">&quot;http://</span><span class="si">%s%s</span><span class="s">:</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">auth_string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_port</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_handler</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span> <span class="p">:</span> <span class="n">proxy_addr</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">ensure_ascii</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_json_loads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_loads_ascii</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span> <span class="o">=</span> <span class="n">ClientCapabilities</span><span class="p">()</span>
        <span class="c"># this relies on self.client_caps being set first </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_user_agent</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_server_caps</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># test to ensure the the server supports the json API</span>
        <span class="c"># call to server will only be made once and will raise error</span>
        <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span>

        <span class="c"># When using auth_token in a 2FA scenario we need to switch to session-based</span>
        <span class="c"># authentication because the auth token will no longer be valid after a first use.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session_token</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="bp">None</span>


    <span class="c"># ========================================================================</span>
    <span class="c"># API Functions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">server_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns server information.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">server_info</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">server_caps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: ServerCapabilities that describe the server the client is</span>
<span class="sd">            connected to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_caps</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_server_caps</span><span class="o">.</span><span class="n">host</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_server_caps</span> <span class="o">=</span> <span class="n">ServerCapabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_caps</span>

<div class="viewcode-block" id="Shotgun.connect"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Forces the client to connect to the server if it is not already</span>
<span class="sd">        connected.</span>

<span class="sd">        NOTE: The client will automatically connect to the server. Only</span>
<span class="sd">        call this function if you wish to confirm the client can connect.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Shotgun.close"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes the current connection to the server.</span>

<span class="sd">        If the client needs to connect again it will do so automatically.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close_connection</span><span class="p">()</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Shotgun.info"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls the Info function on the Shotgun API to get the server meta.</span>

<span class="sd">        :returns: dict of the server meta data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;info&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">include_auth_params</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.find_one"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.find_one">[docs]</a>    <span class="k">def</span> <span class="nf">find_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">filter_operator</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">retired_only</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_archived_projects</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls the find() method and returns the first result, or None.</span>

<span class="sd">        :param entity_type: Required, entity type (string) to find.</span>

<span class="sd">        :param filters: Required, list of filters to apply.</span>

<span class="sd">        :param fields: Optional list of fields from the matched entities to</span>
<span class="sd">            return. Defaults to id.</span>

<span class="sd">        :param order: Optional list of fields to order the results by, list</span>
<span class="sd">            has the form [{&#39;field_name&#39;:&#39;foo&#39;,&#39;direction&#39;:&#39;asc or desc&#39;},]</span>

<span class="sd">        :param filter_operator: Optional operator to apply to the filters,</span>
<span class="sd">            supported values are &#39;all&#39; and &#39;any&#39;. Defaults to &#39;all&#39;.</span>

<span class="sd">        :param limit: Optional, number of entities to return per page.</span>
<span class="sd">            Defaults to 0 which returns all entities that match.</span>

<span class="sd">        :param page: Optional, page of results to return. By default all</span>
<span class="sd">            results are returned. Use together with limit.</span>

<span class="sd">        :param retired_only: Optional, flag to return only entities that have</span>
<span class="sd">            been retried. Defaults to False which returns only entities which</span>
<span class="sd">            have not been retired.</span>
<span class="sd">        </span>
<span class="sd">        :returns: Dictionary of requested Shotgun fields and values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span>
            <span class="n">filter_operator</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">retired_only</span><span class="p">,</span> <span class="n">include_archived_projects</span><span class="o">=</span><span class="n">include_archived_projects</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Shotgun.find"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">filter_operator</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">retired_only</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">include_archived_projects</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find entities matching the given filters.</span>

<span class="sd">        :param entity_type: Required, entity type (string) to find.</span>

<span class="sd">        :param filters: Required, list of filters to apply.</span>
<span class="sd">        </span>
<span class="sd">        :param fields: Optional list of fields from the matched entities to</span>
<span class="sd">            return. Defaults to id.</span>
<span class="sd">        </span>
<span class="sd">        :param order: Optional list of fields to order the results by, list</span>
<span class="sd">            has the form [{&#39;field_name&#39;:&#39;foo&#39;,&#39;direction&#39;:&#39;asc or desc&#39;},]</span>
<span class="sd">        </span>
<span class="sd">        :param filter_operator: Optional operator to apply to the filters,</span>
<span class="sd">            supported values are &#39;all&#39; and &#39;any&#39;. Defaults to &#39;all&#39;.</span>
<span class="sd">        </span>
<span class="sd">        :param limit: Optional, number of entities to return per page.</span>
<span class="sd">            Defaults to 0 which returns all entities that match.</span>
<span class="sd">        </span>
<span class="sd">        :param page: Optional, page of results to return. By default all</span>
<span class="sd">            results are returned. Use together with limit.</span>
<span class="sd">        </span>
<span class="sd">        :param retired_only: Optional, flag to return only entities that have</span>
<span class="sd">            been retried. Defaults to False which returns only entities which</span>
<span class="sd">            have not been retired.</span>
<span class="sd">        </span>
<span class="sd">        :param include_archived_projects: Optional, flag to include entities</span>
<span class="sd">            whose projects have been archived</span>

<span class="sd">        :returns: list of the dicts for each entity with the requested fields,</span>
<span class="sd">            and their id and type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">limit</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;limit parameter must be a positive integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">page</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;page parameter must be a positive integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="n">_translate_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">filter_operator</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filter_operator</span><span class="p">:</span>
            <span class="c">#TODO:Not sure if this test is correct, replicated from prev api</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Deprecated: Use of filter_operator for find()&quot;</span>
                <span class="s">&quot; is not valid any more. See the documentation on find()&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_archived_projects</span><span class="p">:</span>
            <span class="c"># This defaults to True on the server (no argument is sent)</span>
            <span class="c"># So we only need to check the server version if it is False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">ensure_include_archived_projects</span><span class="p">()</span>


        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_read_parameters</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span>
                                                 <span class="n">fields</span><span class="p">,</span>
                                                 <span class="n">filters</span><span class="p">,</span>
                                                 <span class="n">retired_only</span><span class="p">,</span>
                                                 <span class="n">order</span><span class="p">,</span>
                                                 <span class="n">include_archived_projects</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">limit</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">records_per_page</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&quot;paging&quot;</span><span class="p">][</span><span class="s">&quot;entities_per_page&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
            <span class="c"># If page isn&#39;t set and the limit doesn&#39;t require pagination,</span>
            <span class="c"># then trigger the faster code path.</span>
            <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;api_return_image_urls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># if page is specified, then only return the page of records requested</span>
        <span class="k">if</span> <span class="n">page</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># No paging_info needed, so optimize it out.</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&quot;return_paging_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&quot;paging&quot;</span><span class="p">][</span><span class="s">&quot;current_page&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
            <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;entities&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>

        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;entities&quot;</span><span class="p">):</span>
            <span class="n">records</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;entities&quot;</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">limit</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">records</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="n">result</span><span class="p">[</span><span class="s">&quot;paging_info&quot;</span><span class="p">][</span><span class="s">&quot;entity_count&quot;</span><span class="p">]:</span>
                <span class="k">break</span>

            <span class="n">params</span><span class="p">[</span><span class="s">&#39;paging&#39;</span><span class="p">][</span><span class="s">&#39;current_page&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>


</div>
    <span class="k">def</span> <span class="nf">_construct_read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">entity_type</span><span class="p">,</span>
                                   <span class="n">fields</span><span class="p">,</span>
                                   <span class="n">filters</span><span class="p">,</span>
                                   <span class="n">retired_only</span><span class="p">,</span>
                                   <span class="n">order</span><span class="p">,</span>
                                   <span class="n">include_archived_projects</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">params</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity_type</span>
        <span class="n">params</span><span class="p">[</span><span class="s">&quot;return_fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span> <span class="ow">or</span> <span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">params</span><span class="p">[</span><span class="s">&quot;filters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filters</span>
        <span class="n">params</span><span class="p">[</span><span class="s">&quot;return_only&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">retired_only</span> <span class="ow">and</span> <span class="s">&#39;retired&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&quot;active&quot;</span>
        <span class="n">params</span><span class="p">[</span><span class="s">&quot;return_paging_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">params</span><span class="p">[</span><span class="s">&quot;paging&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;entities_per_page&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">records_per_page</span><span class="p">,</span>
                             <span class="s">&quot;current_page&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>

        <span class="k">if</span> <span class="n">include_archived_projects</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="c"># Defaults to True on the server, so only pass it if it&#39;s False</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&quot;include_archived_projects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">order</span><span class="p">:</span>
            <span class="n">sort_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sort</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;column&#39;</span><span class="p">):</span>
                    <span class="c"># TODO: warn about deprecation of &#39;column&#39; param name</span>
                    <span class="n">sort</span><span class="p">[</span><span class="s">&#39;field_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort</span><span class="p">[</span><span class="s">&#39;column&#39;</span><span class="p">]</span>
                <span class="n">sort</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&quot;direction&quot;</span><span class="p">,</span> <span class="s">&quot;asc&quot;</span><span class="p">)</span>
                <span class="n">sort_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s">&#39;field_name&#39;</span><span class="p">:</span> <span class="n">sort</span><span class="p">[</span><span class="s">&#39;field_name&#39;</span><span class="p">],</span>
                    <span class="s">&#39;direction&#39;</span> <span class="p">:</span> <span class="n">sort</span><span class="p">[</span><span class="s">&#39;direction&#39;</span><span class="p">]</span>
                <span class="p">})</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;sorts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_list</span>
        <span class="k">return</span> <span class="n">params</span>


    <span class="k">def</span> <span class="nf">_add_project_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">project_entity</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">project_entity</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">ensure_per_project_customization</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&quot;project&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">project_entity</span>

        <span class="k">return</span> <span class="n">params</span>


<div class="viewcode-block" id="Shotgun.summarize"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.summarize">[docs]</a>    <span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">entity_type</span><span class="p">,</span>
                  <span class="n">filters</span><span class="p">,</span>
                  <span class="n">summary_fields</span><span class="p">,</span>
                  <span class="n">filter_operator</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">grouping</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">include_archived_projects</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summarize column data returned by a query.</span>
<span class="sd">        </span>
<span class="sd">        This provides the same functionality as the summaries in the UI. </span>
<span class="sd">        You can specify one or more fields to summarize, choose the summary </span>
<span class="sd">        type for each, and optionally group the results which will return </span>
<span class="sd">        summary information for each group as well as the total for the query.</span>
<span class="sd">        </span>
<span class="sd">        :param entity_type: The entity type to summarize</span>
<span class="sd">        </span>
<span class="sd">        :param filters: An array of conditions used to filter the find query.</span>
<span class="sd">                        Uses the same syntax as for example the find() method.</span>
<span class="sd">        </span>
<span class="sd">        :param summary_fields: A list of dictionaries with the following keys:</span>
<span class="sd">            </span>
<span class="sd">            :field: Which field you are summarizing</span>
<span class="sd">            :type: The type of summary you are performing on the field. </span>
<span class="sd">              Summary types can be any of [record_count, count, sum, </span>
<span class="sd">              maximum, minimum, average, earliest, latest, percentage, </span>
<span class="sd">              status_percentage, status_list, checked, unchecked] </span>
<span class="sd">              depending on the type of field you&#39;re summarizing.</span>

<span class="sd">        :param filter_operator: Controls how the filters are matched. There are only two valid </span>
<span class="sd">            options, `all` and `any`. You cannot currently combine the two options in the same query. </span>
<span class="sd">            Defaults to &quot;all&quot;.</span>
<span class="sd">        </span>
<span class="sd">        :param grouping: Optional list of dicts with the following keys:</span>
<span class="sd">                </span>
<span class="sd">                :field: a string indicating the field on entity_type to group results by.</span>
<span class="sd">                :type: a string indicating the type of grouping to perform </span>
<span class="sd">                    for each group. Valid types depend on the type of field </span>
<span class="sd">                    you are grouping on and can be one of [exact, tens, hundreds, </span>
<span class="sd">                    thousands, tensofthousands, hundredsofthousands, millions, </span>
<span class="sd">                    day, week, month, quarter, year, clustered_date, oneday, </span>
<span class="sd">                    fivedays, entitytype, firstletter].</span>
<span class="sd">                :direction: a string that sets the order to display the </span>
<span class="sd">                    grouped results. Valid direction options are asc (default) </span>
<span class="sd">                    and desc.</span>
<span class="sd">                  </span>
<span class="sd">        :returns: dict object containing grouping and summaries keys.</span>
<span class="sd">                </span>
<span class="sd">                :grouping: list of dictionaries containing grouping </span>
<span class="sd">                    information:</span>
<span class="sd">                :group_name: Display name of the value that defines the group.</span>
<span class="sd">                    </span>
<span class="sd">                    :group_value: Data representation of the value that defines the group.</span>
<span class="sd">                    :summaries: see summary key</span>
<span class="sd">                    :groups: For nested groups. This structure will be repeated with the same </span>
<span class="sd">                        structure as defined in the top-level grouping key.</span>

<span class="sd">                :summaries: Dict of key/value pairs where the key is the field name and the value </span>
<span class="sd">                  is the summary value requested for that field.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grouping</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">grouping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;summarize() &#39;grouping&#39; parameter must be a list or None&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="n">_translate_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">filter_operator</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_archived_projects</span><span class="p">:</span>
            <span class="c"># This defaults to True on the server (no argument is sent)</span>
            <span class="c"># So we only need to check the server version if it is False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">ensure_include_archived_projects</span><span class="p">()</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
                  <span class="s">&quot;summaries&quot;</span><span class="p">:</span> <span class="n">summary_fields</span><span class="p">,</span>
                  <span class="s">&quot;filters&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">include_archived_projects</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="c"># Defaults to True on the server, so only pass it if it&#39;s False</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&quot;include_archived_projects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">grouping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;grouping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouping</span>

        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&#39;summarize&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">records</span>
</div>
<div class="viewcode-block" id="Shotgun.create"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">return_fields</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new entity of the specified entity_type.</span>

<span class="sd">        :param entity_type: Required, entity type (string) to create.</span>
<span class="sd">        </span>
<span class="sd">        :param data: Required, dict fields to set on the new entity.</span>
<span class="sd">        </span>
<span class="sd">        :param return_fields: Optional list of fields from the new entity</span>
<span class="sd">            to return. Defaults to &#39;id&#39; field.</span>

<span class="sd">        :returns: dict of the requested fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_fields</span><span class="p">:</span>
            <span class="n">return_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>

        <span class="n">upload_image</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s">&#39;image&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">upload_image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;image&#39;</span><span class="p">)</span>

        <span class="n">upload_filmstrip_image</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s">&#39;filmstrip_image&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Filmstrip thumbnail support requires server version 3.1 or &quot;</span>\
                    <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>
            <span class="n">upload_filmstrip_image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;filmstrip_image&#39;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s">&quot;fields&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_list</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="s">&quot;return_fields&quot;</span> <span class="p">:</span> <span class="n">return_fields</span>
        <span class="p">}</span>

        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">upload_image</span><span class="p">:</span>
            <span class="n">image_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_thumbnail</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span>
                                             <span class="n">upload_image</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="p">[[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;is&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)]],</span>
                                  <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;image&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">upload_filmstrip_image</span><span class="p">:</span>
            <span class="n">filmstrip_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_filmstrip_thumbnail</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">upload_filmstrip_image</span><span class="p">)</span>
            <span class="n">filmstrip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span>
                                     <span class="p">[[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;is&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)]],</span>
                                     <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;filmstrip_image&#39;</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;filmstrip_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filmstrip</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;filmstrip_image&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Shotgun.update"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the specified entity with the supplied data.</span>

<span class="sd">        :param entity_type: Required, entity type (string) to update.</span>
<span class="sd">        </span>
<span class="sd">        :param entity_id: Required, id of the entity to update.</span>
<span class="sd">        </span>
<span class="sd">        :param data: Required, dict fields to update on the entity.</span>

<span class="sd">        :returns: dict of the fields updated, with the entity_type and</span>
<span class="sd">            id added.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">upload_image</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s">&#39;image&#39;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">upload_image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;image&#39;</span><span class="p">)</span>
        <span class="n">upload_filmstrip_image</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s">&#39;filmstrip_image&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Filmstrip thumbnail support requires server version 3.1 or &quot;</span>\
                    <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>
            <span class="n">upload_filmstrip_image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;filmstrip_image&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
                <span class="s">&quot;id&quot;</span> <span class="p">:</span> <span class="n">entity_id</span><span class="p">,</span>
                <span class="s">&quot;fields&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;update&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">entity_id</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">upload_image</span><span class="p">:</span>
            <span class="n">image_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_thumbnail</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span>
                                             <span class="n">upload_image</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="p">[[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;is&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)]],</span>
                                  <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;image&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">upload_filmstrip_image</span><span class="p">:</span>
            <span class="n">filmstrip_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_filmstrip_thumbnail</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">upload_filmstrip_image</span><span class="p">)</span>
            <span class="n">filmstrip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span>
                                     <span class="p">[[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;is&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)]],</span>
                                     <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;filmstrip_image&#39;</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;filmstrip_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filmstrip</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;filmstrip_image&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Shotgun.delete"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retire the specified entity.</span>

<span class="sd">        The entity can be brought back to life using the revive function.</span>

<span class="sd">        :param entity_type: Required, entity type (string) to delete.</span>
<span class="sd">        </span>
<span class="sd">        :param entity_id: Required, id of the entity to delete.</span>

<span class="sd">        :returns: True if the entity was deleted, False otherwise e.g. if the</span>
<span class="sd">            entity has previously been deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s">&quot;id&quot;</span> <span class="p">:</span> <span class="n">entity_id</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;delete&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.revive"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.revive">[docs]</a>    <span class="k">def</span> <span class="nf">revive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Revive an entity that has previously been deleted.</span>

<span class="sd">        :param entity_type: Required, entity type (string) to revive.</span>
<span class="sd">        </span>
<span class="sd">        :param entity_id: Required, id of the entity to revive.</span>

<span class="sd">        :returns: True if the entity was revived, False otherwise e.g. if the</span>
<span class="sd">            entity has previously been revived (or was not deleted).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s">&quot;id&quot;</span> <span class="p">:</span> <span class="n">entity_id</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;revive&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.batch"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.batch">[docs]</a>    <span class="k">def</span> <span class="nf">batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requests</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a batch request  of several create, update and delete calls.</span>

<span class="sd">        All requests are performed within a transaction, so either all will</span>
<span class="sd">        complete or none will.</span>

<span class="sd">        :param requests: A list of dict&#39;s of the form which have a</span>
<span class="sd">            request_type key and also specifies</span>
<span class="sd">            </span>
<span class="sd">            * create: entity_type, data dict of fields to set</span>
<span class="sd">            * update: entity_type, entity_id, data dict of fields to set</span>
<span class="sd">            * delete: entity_type and entity_id</span>

<span class="sd">        :returns: A list of values for each operation, create and update</span>
<span class="sd">            requests return a dict of the fields updated. Delete requests</span>
<span class="sd">            return True if the entity was deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">requests</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;batch() expects a list.  Instead was sent &quot;</span>\
                <span class="s">&quot;a </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">requests</span><span class="p">))</span>

        <span class="c"># If we have no requests, just return an empty list immediately.</span>
        <span class="c"># Nothing to process means nothing to get results of.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">requests</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">calls</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">_required_keys</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">required_keys</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_keys</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> missing required key: </span><span class="si">%s</span><span class="s">. &quot;</span>\
                    <span class="s">&quot;Value was: </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">),</span> <span class="n">data</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
            <span class="n">_required_keys</span><span class="p">(</span><span class="s">&quot;Batched request&quot;</span><span class="p">,</span>
                           <span class="p">[</span><span class="s">&#39;request_type&#39;</span><span class="p">,</span> <span class="s">&#39;entity_type&#39;</span><span class="p">],</span>
                           <span class="n">req</span><span class="p">)</span>
            <span class="n">request_params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;request_type&#39;</span><span class="p">:</span> <span class="n">req</span><span class="p">[</span><span class="s">&#39;request_type&#39;</span><span class="p">],</span>
                              <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="n">req</span><span class="p">[</span><span class="s">&quot;entity_type&quot;</span><span class="p">]}</span>

            <span class="k">if</span> <span class="n">req</span><span class="p">[</span><span class="s">&quot;request_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;create&quot;</span><span class="p">:</span>
                <span class="n">_required_keys</span><span class="p">(</span><span class="s">&quot;Batched create request&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">],</span> <span class="n">req</span><span class="p">)</span>
                <span class="n">request_params</span><span class="p">[</span><span class="s">&#39;fields&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_list</span><span class="p">(</span><span class="n">req</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">])</span>
                <span class="n">request_params</span><span class="p">[</span><span class="s">&quot;return_fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;return_fields&quot;</span><span class="p">)</span> <span class="ow">or</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">req</span><span class="p">[</span><span class="s">&quot;request_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;update&quot;</span><span class="p">:</span>
                <span class="n">_required_keys</span><span class="p">(</span><span class="s">&quot;Batched update request&quot;</span><span class="p">,</span>
                               <span class="p">[</span><span class="s">&#39;entity_id&#39;</span><span class="p">,</span> <span class="s">&#39;data&#39;</span><span class="p">],</span>
                               <span class="n">req</span><span class="p">)</span>
                <span class="n">request_params</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s">&#39;entity_id&#39;</span><span class="p">]</span>
                <span class="n">request_params</span><span class="p">[</span><span class="s">&#39;fields&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_list</span><span class="p">(</span><span class="n">req</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">req</span><span class="p">[</span><span class="s">&quot;request_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;delete&quot;</span><span class="p">:</span>
                <span class="n">_required_keys</span><span class="p">(</span><span class="s">&quot;Batched delete request&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;entity_id&#39;</span><span class="p">],</span> <span class="n">req</span><span class="p">)</span>
                <span class="n">request_params</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s">&#39;entity_id&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Invalid request_type &#39;</span><span class="si">%s</span><span class="s">&#39; for batch&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                   <span class="n">req</span><span class="p">[</span><span class="s">&quot;request_type&quot;</span><span class="p">]))</span>
            <span class="n">calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_params</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;batch&quot;</span><span class="p">,</span> <span class="n">calls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.work_schedule_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.work_schedule_read">[docs]</a>    <span class="k">def</span> <span class="nf">work_schedule_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the work day rules for a given date range.</span>

<span class="sd">        reasons:</span>
<span class="sd">            STUDIO_WORK_WEEK</span>
<span class="sd">            STUDIO_EXCEPTION</span>
<span class="sd">            PROJECT_WORK_WEEK</span>
<span class="sd">            PROJECT_EXCEPTION</span>
<span class="sd">            USER_WORK_WEEK</span>
<span class="sd">            USER_EXCEPTION</span>


<span class="sd">        :param start_date: Start date of date range.</span>
<span class="sd">        :type start_date: str (YYYY-MM-DD)</span>
<span class="sd">        </span>
<span class="sd">        :param end_date: End date of date range.</span>
<span class="sd">        :type end_date: str (YYYY-MM-DD)</span>
<span class="sd">        </span>
<span class="sd">        :param dict project: Project entity to query WorkDayRules for. (optional)</span>
<span class="sd">        </span>
<span class="sd">        :param dict user: User entity to query WorkDayRules for. (optional)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Work schedule support requires server version 3.2 or &quot;</span>\
                <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;The start_date and end_date arguments must be strings in YYYY-MM-DD format&quot;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
            <span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="n">user</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&#39;work_schedule_read&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.work_schedule_update"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.work_schedule_update">[docs]</a>    <span class="k">def</span> <span class="nf">work_schedule_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">working</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">recalculate_field</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the work schedule for a given date. If neither project nor user are passed the studio work schedule will be updated.</span>
<span class="sd">        Project and User can only be used separately.</span>

<span class="sd">        :param date: Date of WorkDayRule to update. </span>
<span class="sd">        :type date: str (YYYY-MM-DD)</span>
<span class="sd">        </span>
<span class="sd">        :param bool working:</span>
<span class="sd">        </span>
<span class="sd">        :param str description: Reason for time off. (optional)</span>
<span class="sd">        </span>
<span class="sd">        :param dict project: Project entity to assign to. Cannot be used with user. (optional)</span>
<span class="sd">        </span>
<span class="sd">        :param dict user: User entity to assign to. Cannot be used with project. (optional)</span>
<span class="sd">        </span>
<span class="sd">        :param str recalculate_field: Choose the schedule field that will be recalculated on Tasks when they are affected by a change in working schedule. &#39;due_date&#39; or &#39;duration&#39;, default is a Site Preference (optional)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Work schedule support requires server version 3.2 or &quot;</span>\
                <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;The date argument must be string in YYYY-MM-DD format&quot;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="n">working</span><span class="o">=</span><span class="n">working</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
            <span class="n">recalculate_field</span><span class="o">=</span><span class="n">recalculate_field</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&#39;work_schedule_update&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.follow"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.follow">[docs]</a>    <span class="k">def</span> <span class="nf">follow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds the entity to the user&#39;s followed entities (or does nothing if the user is already following the entity)</span>
<span class="sd">        </span>
<span class="sd">        :param dict user: User entity to follow the entity</span>
<span class="sd">        </span>
<span class="sd">        :param dict entity: Entity to be followed</span>
<span class="sd">        </span>
<span class="sd">        :returns: dict with &#39;followed&#39;=true, and dicts for the &#39;user&#39; and &#39;entity&#39; that were passed in</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Follow support requires server version 5.2 or &quot;</span>\
                <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>
        
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">entity</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&#39;follow&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.unfollow"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.unfollow">[docs]</a>    <span class="k">def</span> <span class="nf">unfollow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes entity from the user&#39;s followed entities (or does nothing if the user is not following the entity)</span>
<span class="sd">        </span>
<span class="sd">        :param dict user: User entity to unfollow the entity</span>
<span class="sd">        </span>
<span class="sd">        :param dict entity: Entity to be unfollowed</span>
<span class="sd">        </span>
<span class="sd">        :returns: dict with &#39;unfollowed&#39;=true, and dicts for the &#39;user&#39; and &#39;entity&#39; that were passed in</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Follow support requires server version 5.2 or &quot;</span>\
                <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>
        
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">entity</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&#39;unfollow&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.followers"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.followers">[docs]</a>    <span class="k">def</span> <span class="nf">followers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all followers of the entity.</span>
<span class="sd">        </span>
<span class="sd">        :param dict entity: Find all followers of this entity</span>
<span class="sd">        </span>
<span class="sd">        :returns list of dicts for all the users following the entity</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Follow support requires server version 5.2 or &quot;</span>\
                <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>
        
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">entity</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&#39;followers&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.schema_entity_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_entity_read">[docs]</a>    <span class="k">def</span> <span class="nf">schema_entity_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_entity</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all active entities defined in the schema.</span>

<span class="sd">        :param dict project_entity: Optional, if set, each field&#39;s visibility is reported </span>
<span class="sd">            accordingly to the specified project&#39;s current visibility settings. If None, all </span>
<span class="sd">            fields are reported as visible.</span>

<span class="sd">        :returns: dict of Entity Type to dict containing the display name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_project_param</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">project_entity</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;schema_entity_read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;schema_entity_read&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.schema_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_read">[docs]</a>    <span class="k">def</span> <span class="nf">schema_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_entity</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the schema for all fields in all entities.</span>

<span class="sd">        :param dict project_entity: Optional, if set, each field&#39;s visibility is reported </span>
<span class="sd">            accordingly to the specified project&#39;s current visibility settings. If None, all </span>
<span class="sd">            fields are reported as visible.</span>

<span class="sd">        :returns: nested dicts</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_project_param</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">project_entity</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;schema_read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;schema_read&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.schema_field_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_field_read">[docs]</a>    <span class="k">def</span> <span class="nf">schema_field_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">project_entity</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all schema for fields in the specified entity_type or one</span>
<span class="sd">        field.</span>

<span class="sd">        :param entity_type: Required, entity type (string) to get the schema for.</span>
<span class="sd">        </span>
<span class="sd">        :param field_name: Optional, name of the field to get the schema definition for. If not </span>
<span class="sd">            supplied all fields for the entity type are returned.</span>

<span class="sd">        :param dict project_entity: Optional, if set, each field&#39;s visibility is reported </span>
<span class="sd">            accordingly to the specified project&#39;s current visibility settings. If None, all fields </span>
<span class="sd">            are reported as visible.</span>

<span class="sd">        :returns: dict of field name to nested dicts which describe the field</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">field_name</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&quot;field_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_name</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_project_param</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">project_entity</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;schema_field_read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.schema_field_create"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_field_create">[docs]</a>    <span class="k">def</span> <span class="nf">schema_field_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">display_name</span><span class="p">,</span>
        <span class="n">properties</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a field for the specified entity type.</span>

<span class="sd">        :param entity_type: Required, entity type (string) to add the field to</span>
<span class="sd">        </span>
<span class="sd">        :param data_type: Required, Shotgun data type for the new field.</span>
<span class="sd">        </span>
<span class="sd">        :param display_name: Required, display name for the new field.</span>
<span class="sd">        </span>
<span class="sd">        :param properties: Optional, dict of properties for the new field.</span>

<span class="sd">        :returns: The Shotgun name (string) for the new field, this is</span>
<span class="sd">            different to the display_name passed in.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s">&quot;data_type&quot;</span> <span class="p">:</span> <span class="n">data_type</span><span class="p">,</span>
            <span class="s">&quot;properties&quot;</span> <span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s">&#39;property_name&#39;</span><span class="p">:</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="n">display_name</span><span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">[</span><span class="s">&quot;properties&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_list</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span>
            <span class="n">key_name</span><span class="o">=</span><span class="s">&quot;property_name&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s">&quot;value&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;schema_field_create&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.schema_field_update"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_field_update">[docs]</a>    <span class="k">def</span> <span class="nf">schema_field_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the specified field definition with the supplied</span>
<span class="sd">        properties.</span>

<span class="sd">        :param entity_type: Required, entity type (string) to add the field to</span>
<span class="sd">        </span>
<span class="sd">        :param field_name: Required, Shotgun name of the field to update.</span>
<span class="sd">        </span>
<span class="sd">        :param properties: Required, dict of updated properties for the field.</span>
<span class="sd">        :returns: True if the field was updated, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s">&quot;field_name&quot;</span> <span class="p">:</span> <span class="n">field_name</span><span class="p">,</span>
            <span class="s">&quot;properties&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s">&quot;property_name&quot;</span> <span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s">&quot;value&quot;</span> <span class="p">:</span> <span class="n">v</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;schema_field_update&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.schema_field_delete"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_field_delete">[docs]</a>    <span class="k">def</span> <span class="nf">schema_field_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes the specified field definition from the entity_type.</span>

<span class="sd">        :param entity_type: Required, entity type (string) to delete the field</span>
<span class="sd">            from.</span>
<span class="sd">        </span>
<span class="sd">        :param field_name: Required, Shotgun name of the field to delete.</span>
<span class="sd">        </span>
<span class="sd">        :param properties: Required, dict of updated properties for the field.</span>

<span class="sd">        :returns: True if the field was updated, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s">&quot;field_name&quot;</span> <span class="p">:</span> <span class="n">field_name</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;schema_field_delete&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.add_user_agent"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.add_user_agent">[docs]</a>    <span class="k">def</span> <span class="nf">add_user_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add agent to the user-agent header.</span>

<span class="sd">        Append agent to the string passed in as the user-agent to be logged</span>
<span class="sd">        in events for this API session.</span>

<span class="sd">        :param agent: Required, string to append to user-agent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_agents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.reset_user_agent"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.reset_user_agent">[docs]</a>    <span class="k">def</span> <span class="nf">reset_user_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset user agent to the default.</span>

<span class="sd">        Eg. shotgun-json (3.0.17); Python 2.6 (Mac)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ua_platform</span> <span class="o">=</span> <span class="s">&quot;Unknown&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">platform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ua_platform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_agents</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;shotgun-json (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">__version__</span><span class="p">,</span>
                             <span class="s">&quot;Python </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">py_version</span><span class="p">,</span> <span class="n">ua_platform</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="Shotgun.set_session_uuid"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.set_session_uuid">[docs]</a>    <span class="k">def</span> <span class="nf">set_session_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_uuid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the browser session_uuid for this API session.</span>

<span class="sd">        Once set events generated by this API session will include the</span>
<span class="sd">        session_uuid in their EventLogEntries.</span>

<span class="sd">        :param session_uuid: Session UUID to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_uuid</span> <span class="o">=</span> <span class="n">session_uuid</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Shotgun.share_thumbnail"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.share_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">share_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities</span><span class="p">,</span> <span class="n">thumbnail_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source_entity</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">filmstrip_thumbnail</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Associate a thumbnail with more than one Shotgun entity.</span>
<span class="sd">    </span>
<span class="sd">        Share the thumbnail from between entities without requiring </span>
<span class="sd">        uploading the thumbnail file multiple times. You can use this in </span>
<span class="sd">        two ways: </span>
<span class="sd">        </span>
<span class="sd">        1) Upload an image to set as the thumbnail on multiple entities. </span>
<span class="sd">        2) Update multiple entities to point to an existing entity&#39;s thumbnail.</span>

<span class="sd">        Please note that when sharing a filmstrip thumbnail, it is required </span>
<span class="sd">        to have a static thumbnail in place before the filmstrip will </span>
<span class="sd">        be displayed in the Shotgun web UI.        </span>
<span class="sd">        </span>
<span class="sd">        :param entities: The entities to update to point to the shared </span>
<span class="sd">                         thumbnail provided in standard hash (dict) format.</span>
<span class="sd">                         Example:: </span>

<span class="sd">                            [{&#39;type&#39;: &#39;Version&#39;, &#39;id&#39;: 123}, </span>
<span class="sd">                             {&#39;type&#39;: &#39;Version&#39;, &#39;id&#39;: 456}]</span>
<span class="sd">        </span>
<span class="sd">        :param thumbnail_path: Required if source_entity is not provided.</span>
<span class="sd">                               The full path to the local thumbnail file to </span>
<span class="sd">                               upload and share.</span>
<span class="sd">        </span>
<span class="sd">        :param source_entity: Required if source_entity is not provided.</span>
<span class="sd">                              The entity whoes thumbnail will be the source </span>
<span class="sd">                              for sharing. Dictionary with type and id.</span>
<span class="sd">        </span>
<span class="sd">        :param filmstrip_thumbnail: If True, the filmstrip_thumbnail will be </span>
<span class="sd">                                    shared. If False (default), the static </span>
<span class="sd">                                    thumbnail will be shared.</span>
<span class="sd">                                  </span>
<span class="sd">        :returns: Id of the Attachment entity that was created for the image </span>
<span class="sd">                  if a thumbnail was uploaded successfully.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Thumbnail sharing support requires server &quot;</span>\
                <span class="s">&quot;version 4.0 or higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;&#39;entities&#39; parameter must be a list of entity &quot;</span>\
                <span class="s">&quot;hashes and may not be empty&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span> <span class="ow">or</span> <span class="s">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;&#39;entities&#39; parameter must be a list of &quot;</span>\
                    <span class="s">&quot;entity hashes with at least &#39;type&#39; and &#39;id&#39; keys.</span><span class="se">\n</span><span class="s">Invalid &quot;</span>\
                    <span class="s">&quot;entity: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">thumbnail_path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">source_entity</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">thumbnail_path</span> <span class="ow">and</span> <span class="n">source_entity</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;You must supply either thumbnail_path OR &quot;</span>\
                <span class="s">&quot;source_entity.&quot;</span><span class="p">)</span>

        <span class="c"># upload thumbnail</span>
        <span class="k">if</span> <span class="n">thumbnail_path</span><span class="p">:</span>
            <span class="n">source_entity</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filmstrip_thumbnail</span><span class="p">:</span>
                <span class="n">thumb_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_filmstrip_thumbnail</span><span class="p">(</span><span class="n">source_entity</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span>
                    <span class="n">source_entity</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">thumbnail_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thumb_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_thumbnail</span><span class="p">(</span><span class="n">source_entity</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span>
                    <span class="n">source_entity</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">thumbnail_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_entity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source_entity</span> \
                <span class="ow">or</span> <span class="s">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source_entity</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;&#39;source_entity&#39; parameter must be a dict &quot;</span>\
                    <span class="s">&quot;with at least &#39;type&#39; and &#39;id&#39; keys.</span><span class="se">\n</span><span class="s">Got: </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&quot;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="n">source_entity</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">source_entity</span><span class="p">)))</span>

        <span class="c"># only 1 entity in list and we already uploaded the thumbnail to it</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">thumb_id</span>

        <span class="c"># update entities with source_entity thumbnail</span>
        <span class="n">entities_str</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">entities_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]))</span>
        <span class="c"># format for post request</span>
        <span class="k">if</span> <span class="n">filmstrip_thumbnail</span><span class="p">:</span>
            <span class="n">filmstrip_thumbnail</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;entities&quot;</span> <span class="p">:</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entities_str</span><span class="p">),</span>
            <span class="s">&quot;source_entity&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">source_entity</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span> <span class="n">source_entity</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]),</span>
            <span class="s">&quot;filmstrip_thumbnail&quot;</span> <span class="p">:</span> <span class="n">filmstrip_thumbnail</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_auth_params</span><span class="p">())</span>

        <span class="c"># Create opener with extended form post support</span>
        <span class="n">opener</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_opener</span><span class="p">(</span><span class="n">FormPostHandler</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
            <span class="s">&quot;/upload/share_thumbnail&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

        <span class="c"># Perform the request</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="c"># response headers are in str(resp.info()).splitlines()</span>
        <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">500</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Server encountered an internal error. &quot;</span>
                    <span class="s">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">(</span><span class="si">%s</span><span class="s">)</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_auth_params</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">e</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Unanticipated error occurred </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Unable to share thumbnail: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">result</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># clearing thumbnail returns no attachment_id</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">attachment_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">attachment_id</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">attachment_id</span>
</div>
<div class="viewcode-block" id="Shotgun.upload_thumbnail"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.upload_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">upload_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convenience function for uploading thumbnails.</span>
<span class="sd">        </span>
<span class="sd">        Additional keyword arguments passed to this method will be forwarded</span>
<span class="sd">        to the upload() method.</span>
<span class="sd">        </span>
<span class="sd">        :param entity_type: Entity type of the entity to associate with</span>
<span class="sd">        </span>
<span class="sd">        :param entity_id: Required, id of the entity to associate with</span>
<span class="sd">        </span>
<span class="sd">        :param path: Path to file on disk</span>
<span class="sd">        </span>
<span class="sd">        :returns: Id of the new attachment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s">&quot;thumb_image&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.upload_filmstrip_thumbnail"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.upload_filmstrip_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">upload_filmstrip_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convenience function for uploading filmstrip thumbnails.</span>

<span class="sd">        Additional keyword arguments passed to this method will be forwarded</span>
<span class="sd">        to the upload() method.</span>
<span class="sd">        </span>
<span class="sd">        :param entity_type: Entity type of the entity to associate with</span>
<span class="sd">        </span>
<span class="sd">        :param entity_id: Required, id of the entity to associate with</span>
<span class="sd">        </span>
<span class="sd">        :param path: Path to file on disk</span>
<span class="sd">        </span>
<span class="sd">        :returns: Id of the new attachment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Filmstrip thumbnail support requires server version 3.1 or &quot;</span>\
                <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s">&quot;filmstrip_thumb_image&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.upload"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.upload">[docs]</a>    <span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">display_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tag_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Upload a file as an attachment/thumbnail to the specified</span>
<span class="sd">        entity_type and entity_id.</span>

<span class="sd">        :param entity_type: Entity type of the entity to associate with</span>
<span class="sd">        </span>
<span class="sd">        :param entity_id: Entity id of the entity to associate with</span>
<span class="sd">        </span>
<span class="sd">        :param path: Path to file on disk</span>
<span class="sd">        </span>
<span class="sd">        :param field_name: the field on the entity to upload to</span>
<span class="sd">            (ignored if thumbnail)</span>
<span class="sd">        </span>
<span class="sd">        :param display_name: the display name to use for the file in the ui</span>
<span class="sd">            (ignored if thumbnail)</span>
<span class="sd">        </span>
<span class="sd">        :param tag_list: comma-separated string of tags to assign to the file</span>

<span class="sd">        :returns: Id of the new attachment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">path</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Path must be a valid file, got &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

        <span class="n">is_thumbnail</span> <span class="o">=</span> <span class="p">(</span><span class="n">field_name</span> <span class="o">==</span> <span class="s">&quot;thumb_image&quot;</span> <span class="ow">or</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s">&quot;filmstrip_thumb_image&quot;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;entity_type&quot;</span> <span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s">&quot;entity_id&quot;</span> <span class="p">:</span> <span class="n">entity_id</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_auth_params</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">is_thumbnail</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                <span class="s">&quot;/upload/publish_thumbnail&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&quot;thumb_image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s">&quot;filmstrip_thumb_image&quot;</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&quot;filmstrip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                <span class="s">&quot;/upload/upload_file&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">display_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">display_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="c"># we allow linking to nothing for generic reference use cases</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&quot;field_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_name</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&quot;display_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">display_name</span>
            <span class="c"># None gets converted to a string and added as a tag...</span>
            <span class="k">if</span> <span class="n">tag_list</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&quot;tag_list&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag_list</span>

            <span class="n">params</span><span class="p">[</span><span class="s">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>

        <span class="c"># Create opener with extended form post support</span>
        <span class="n">opener</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_opener</span><span class="p">(</span><span class="n">FormPostHandler</span><span class="p">)</span>

        <span class="c"># Perform the request</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">500</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Server encountered an internal error. &quot;</span>
                    <span class="s">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">(</span><span class="si">%s</span><span class="s">)</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_auth_params</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">e</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Unanticipated error occurred uploading &quot;</span>
                    <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Could not upload file successfully, but &quot;</span>\
                    <span class="s">&quot;not sure why.</span><span class="se">\n</span><span class="s">Path: </span><span class="si">%s</span><span class="se">\n</span><span class="s">Url: </span><span class="si">%s</span><span class="se">\n</span><span class="s">Error: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">path</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>

        <span class="n">attachment_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">attachment_id</span>
</div>
<div class="viewcode-block" id="Shotgun.download_attachment"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.download_attachment">[docs]</a>    <span class="k">def</span> <span class="nf">download_attachment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attachment</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                            <span class="n">attachment_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Downloads the file associated with a Shotgun Attachment.</span>

<span class="sd">        NOTE: On older (&lt; v5.1.0) Shotgun versions, non-downloadable files </span>
<span class="sd">        on Shotgun don&#39;t raise exceptions, they cause a server error which </span>
<span class="sd">        returns a 200 with the page content.</span>

<span class="sd">        :param attachment: (mixed) Usually a dict representing an Attachment.</span>
<span class="sd">            The dict should have a &#39;url&#39; key that specifies the download url. </span>
<span class="sd">            Optionally, the dict can be a standard entity hash format with &#39;id&#39; and</span>
<span class="sd">            &#39;type&#39; keys as long as &#39;type&#39;==&#39;Attachment&#39;. This is only supported for</span>
<span class="sd">            backwards compatibility (#22150).</span>
<span class="sd">            </span>
<span class="sd">            If an int value is passed in, the Attachment with the matching id will</span>
<span class="sd">            be downloaded from the Shotgun server.</span>

<span class="sd">        :param file_path: (str) Optional. If provided, write the data directly</span>
<span class="sd">            to local disk using the file_path. This avoids loading all of the data </span>
<span class="sd">            in memory and saves the file locally which is probably what is desired</span>
<span class="sd">            anyway. </span>

<span class="sd">        :param attachment_id: (int) Optional. Deprecated in favor of passing in </span>
<span class="sd">            Attachment hash to attachment param. This attachment_id exists only for</span>
<span class="sd">            backwards compatibility for scripts specifying the parameter with</span>
<span class="sd">            keywords.</span>

<span class="sd">        :returns: (str) If file_path is None, returns data of the Attachment </span>
<span class="sd">            file as a string. If file_path is provided, returns file_path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># backwards compatibility when passed via keyword argument </span>
        <span class="k">if</span> <span class="n">attachment</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">attachment_id</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">attachment</span> <span class="o">=</span> <span class="n">attachment_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Missing parameter &#39;attachment&#39;. Expected a &quot;</span>\
                                <span class="s">&quot;dict, int, NoneType value or&quot;</span>\
                                <span class="s">&quot;an int for parameter attachment_id&quot;</span><span class="p">)</span>
        <span class="c"># write to disk</span>
        <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Unable to write Attachment to disk using &quot;</span>\
                              <span class="s">&quot;file_path. </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span> 

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attachment_download_url</span><span class="p">(</span><span class="n">attachment</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># We only need to set the auth cookie for downloads from Shotgun server</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_up_auth_cookie</span><span class="p">()</span>
   
        <span class="k">try</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;user-agent&#39;</span><span class="p">,</span> <span class="s">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_agents</span><span class="p">))</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attachment</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="c"># 400 [sg] Attachment id doesn&#39;t exist or is a local file</span>
        <span class="c"># 403 [s3] link is invalid</span>
        <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;Failed to open </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s">&#39;code&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
                    <span class="n">err</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Attachment may not exist or is a local file?&quot;</span>
                <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
                    <span class="c"># Only parse the body if it is an Amazon S3 url. </span>
                    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;s3.amazonaws.com&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> \
                        <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;application/xml&#39;</span><span class="p">:</span>
                        <span class="n">body</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">body</span><span class="p">:</span>
                            <span class="n">xml</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
                            <span class="c"># Once python 2.4 support is not needed we can think about using elementtree.</span>
                            <span class="c"># The doc is pretty small so this shouldn&#39;t be an issue.</span>
                            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;&lt;Message&gt;(.*)&lt;/Message&gt;&#39;</span><span class="p">,</span> <span class="n">xml</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                                <span class="n">err</span> <span class="o">+=</span> <span class="s">&#39; - </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">ShotgunFileDownloadError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">file_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">attachment</span>
</div>
<div class="viewcode-block" id="Shotgun.set_up_auth_cookie"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.set_up_auth_cookie">[docs]</a>    <span class="k">def</span> <span class="nf">set_up_auth_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets up urllib2 with a cookie for authentication on the Shotgun </span>
<span class="sd">        instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session_token</span><span class="p">()</span>
        <span class="n">cj</span> <span class="o">=</span> <span class="n">cookielib</span><span class="o">.</span><span class="n">LWPCookieJar</span><span class="p">()</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cookielib</span><span class="o">.</span><span class="n">Cookie</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="s">&#39;_session_id&#39;</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span>
            <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">cj</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">cookie_handler</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cj</span><span class="p">)</span>
        <span class="n">opener</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_opener</span><span class="p">(</span><span class="n">cookie_handler</span><span class="p">)</span>
        <span class="n">urllib2</span><span class="o">.</span><span class="n">install_opener</span><span class="p">(</span><span class="n">opener</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Shotgun.get_attachment_download_url"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.get_attachment_download_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_attachment_download_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attachment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the URL for downloading provided Attachment.</span>

<span class="sd">        :param attachment: (mixed) If type is an int, construct url to download</span>
<span class="sd">            Attachment with id from Shotgun. </span>
<span class="sd">            If type is a dict, and a url key is present, use that url. </span>
<span class="sd">            If type is a dict, and url key is not present, check if we have</span>
<span class="sd">            an id and type keys and the type is &#39;Attachment&#39; in which case we </span>
<span class="sd">            construct url to download Attachment with id from Shotgun as if just</span>
<span class="sd">            the id has been passed in. </span>

<span class="sd">        :todo: Support for a standard entity hash should be removed: #22150</span>

<span class="sd">        :returns: (str) the download URL for the Attachment or None if None was</span>
<span class="sd">            passed to attachment param. This avoids raising an error when results</span>
<span class="sd">            from a find() are passed off to a download_attachment() call.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attachment_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attachment</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">attachment_id</span> <span class="o">=</span> <span class="n">attachment</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attachment</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">attachment</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="s">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">attachment</span> <span class="ow">and</span> <span class="s">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">attachment</span> <span class="ow">and</span> 
                    <span class="n">attachment</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Attachment&#39;</span><span class="p">):</span>
                    <span class="n">attachment_id</span> <span class="o">=</span> <span class="n">attachment</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Missing &#39;url&#39; key in Attachment dict&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attachment</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unable to determine download url. Expected &quot;</span>\
                <span class="s">&quot;dict, int, or NoneType. Instead got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">attachment</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">attachment_id</span><span class="p">:</span> 
            <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                <span class="s">&quot;/file_serve/attachment/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">attachment_id</span><span class="p">)),</span>
                <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">url</span>
</div>
<div class="viewcode-block" id="Shotgun.authenticate_human_user"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.authenticate_human_user">[docs]</a>    <span class="k">def</span> <span class="nf">authenticate_human_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_login</span><span class="p">,</span> <span class="n">user_password</span><span class="p">,</span> <span class="n">auth_token</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Authenticate Shotgun HumanUser. </span>
<span class="sd">        </span>
<span class="sd">        Note that HumanUser must be an active account.</span>
<span class="sd">        </span>
<span class="sd">        :param user_login: Login name of Shotgun HumanUser</span>
<span class="sd">        </span>
<span class="sd">        :param user_password: Password for Shotgun HumanUser</span>
<span class="sd">        </span>
<span class="sd">        :param auth_token: One-time token required to authenticate Shotgun HumanUser</span>
<span class="sd">            when two factor authentication is turned on.</span>

<span class="sd">        :return: Dictionary of HumanUser including ID if authenticated, None if unauthorized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_login</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Please supply a username to authenticate.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_password</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Please supply a password for the user.&#39;</span><span class="p">)</span>

        <span class="c"># Override permissions on Config obj</span>
        <span class="n">original_login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span>
        <span class="n">original_password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span>
        <span class="n">original_auth_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="n">user_login</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="n">user_password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">auth_token</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="s">&#39;HumanUser&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s">&#39;sg_status_list&#39;</span><span class="p">,</span> <span class="s">&#39;is&#39;</span><span class="p">,</span> <span class="s">&#39;act&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;login&#39;</span><span class="p">,</span> <span class="s">&#39;is&#39;</span><span class="p">,</span> <span class="n">user_login</span><span class="p">]],</span> <span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;login&#39;</span><span class="p">],</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;all&#39;</span><span class="p">)</span>
            <span class="c"># Set back to default - There finally and except cannot be used together in python2.4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="n">original_login</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="n">original_password</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">original_auth_token</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">except</span> <span class="n">Fault</span><span class="p">:</span>
            <span class="c"># Set back to default - There finally and except cannot be used together in python2.4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="n">original_login</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="n">original_password</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">original_auth_token</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c"># Set back to default - There finally and except cannot be used together in python2.4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="n">original_login</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="n">original_password</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">original_auth_token</span>
            <span class="k">raise</span>

</div>
<div class="viewcode-block" id="Shotgun.update_project_last_accessed"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.update_project_last_accessed">[docs]</a>    <span class="k">def</span> <span class="nf">update_project_last_accessed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update projects last_accessed_by_current_user field.</span>
<span class="sd">        </span>
<span class="sd">        :param project: a project entity hash</span>
<span class="sd">        </span>
<span class="sd">        :param user: A human user entity hash. Optional if either login or sudo_as are used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;update_project_last_accessed requires server version 5.3.20 or &quot;</span>\
                    <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
            <span class="c"># Try to use sudo as user if present</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sudo_as_login</span><span class="p">:</span>
                <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="s">&#39;HumanUser&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s">&#39;login&#39;</span><span class="p">,</span> <span class="s">&#39;is&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sudo_as_login</span><span class="p">]])</span>
            <span class="c"># Try to use login if present</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span><span class="p">:</span>
                <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="s">&#39;HumanUser&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s">&#39;login&#39;</span><span class="p">,</span> <span class="s">&#39;is&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span><span class="p">]])</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;project_id&quot;</span><span class="p">:</span> <span class="n">project</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="p">}</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;user_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>

        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;update_project_last_accessed_by_current_user&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


</div>
<div class="viewcode-block" id="Shotgun.note_thread_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.note_thread_read">[docs]</a>    <span class="k">def</span> <span class="nf">note_thread_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">note_id</span><span class="p">,</span> <span class="n">entity_fields</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the full conversation for a given note, including </span>
<span class="sd">        replies and attachments.</span>
<span class="sd">        </span>
<span class="sd">        Returns a complex data structure on the following form::</span>
<span class="sd">        </span>
<span class="sd">            [{&#39;content&#39;: &#39;Please add more awesomeness to the color grading.&#39;,</span>
<span class="sd">              &#39;created_at&#39;: &#39;2015-07-14 21:33:28 UTC&#39;,</span>
<span class="sd">              &#39;created_by&#39;: {&#39;id&#39;: 38,</span>
<span class="sd">                             &#39;name&#39;: &#39;John Pink&#39;,</span>
<span class="sd">                             &#39;status&#39;: &#39;act&#39;,</span>
<span class="sd">                             &#39;type&#39;: &#39;HumanUser&#39;,</span>
<span class="sd">                             &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">              &#39;id&#39;: 6013,</span>
<span class="sd">              &#39;type&#39;: &#39;Note&#39;},</span>
<span class="sd">             {&#39;created_at&#39;: &#39;2015-07-14 21:33:32 UTC&#39;,</span>
<span class="sd">              &#39;created_by&#39;: {&#39;id&#39;: 38,</span>
<span class="sd">                             &#39;name&#39;: &#39;John Pink&#39;,</span>
<span class="sd">                             &#39;status&#39;: &#39;act&#39;,</span>
<span class="sd">                             &#39;type&#39;: &#39;HumanUser&#39;,</span>
<span class="sd">                             &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">              &#39;id&#39;: 159,</span>
<span class="sd">              &#39;type&#39;: &#39;Attachment&#39;},</span>
<span class="sd">             {&#39;content&#39;: &#39;More awesomeness added&#39;,</span>
<span class="sd">              &#39;created_at&#39;: &#39;2015-07-14 21:54:51 UTC&#39;,</span>
<span class="sd">              &#39;id&#39;: 5,</span>
<span class="sd">              &#39;type&#39;: &#39;Reply&#39;,</span>
<span class="sd">              &#39;user&#39;: {&#39;id&#39;: 38,</span>
<span class="sd">                       &#39;name&#39;: &#39;David Blue&#39;,</span>
<span class="sd">                       &#39;status&#39;: &#39;act&#39;,</span>
<span class="sd">                       &#39;type&#39;: &#39;HumanUser&#39;,</span>
<span class="sd">                       &#39;valid&#39;: &#39;valid&#39;}}]</span>

<span class="sd">        The list is returned in descending chronological order.</span>
<span class="sd">        </span>
<span class="sd">        If you wish to include additional fields beyond the ones that are </span>
<span class="sd">        returned by default, you can specify these in an entity_fields </span>
<span class="sd">        dictionary. This dictonary should be keyed by entity type and each</span>
<span class="sd">        key should contain a list of fields to retrieve, for example::</span>
<span class="sd">        </span>
<span class="sd">            { &quot;Note&quot;:       [&quot;created_by.HumanUser.image&quot;, </span>
<span class="sd">                             &quot;addressings_to&quot;, </span>
<span class="sd">                             &quot;playlist&quot;, </span>
<span class="sd">                             &quot;user&quot; ],</span>
<span class="sd">              &quot;Reply&quot;:      [&quot;content&quot;], </span>
<span class="sd">              &quot;Attachment&quot;: [&quot;filmstrip_image&quot;, </span>
<span class="sd">                            &quot;local_storage&quot;, </span>
<span class="sd">                            &quot;this_file&quot;, </span>
<span class="sd">                            &quot;image&quot;]</span>
<span class="sd">            }</span>
<span class="sd">        </span>
<span class="sd">        :param note_id: The id for the note to be retrieved</span>
<span class="sd">        </span>
<span class="sd">        :param entity_fields: Additional fields to retrieve as part </span>
<span class="sd">                              of the request. See above for details.</span>
<span class="sd">                              </span>
<span class="sd">        :returns: A list of dictionaries. See above for example. </span>
<span class="sd">        &quot;&quot;&quot;</span>        

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;note_thread requires server version 6.2.0 or &quot;</span>\
                    <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="n">entity_fields</span> <span class="o">=</span> <span class="n">entity_fields</span> <span class="ow">or</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity_fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;entity_fields parameter must be a dictionary&quot;</span><span class="p">)</span>
        
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;note_id&quot;</span><span class="p">:</span> <span class="n">note_id</span><span class="p">,</span> <span class="s">&quot;entity_fields&quot;</span><span class="p">:</span> <span class="n">entity_fields</span> <span class="p">}</span>

        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;note_thread_contents&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="Shotgun.text_search"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.text_search">[docs]</a>    <span class="k">def</span> <span class="nf">text_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">entity_types</span><span class="p">,</span> <span class="n">project_ids</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Searches across the specified entity types for the given text.</span>
<span class="sd">        </span>
<span class="sd">        This method can be used to implement auto completion or a Shotgun </span>
<span class="sd">        global search. The method requires a text input phrase that is at least </span>
<span class="sd">        three characters long, or an exception will be raised.</span>
<span class="sd">        </span>
<span class="sd">        Several ways to limit the results of the query are available: </span>
<span class="sd">        </span>
<span class="sd">        * Using the project_ids parameter, you can provide a list </span>
<span class="sd">          of project ids to search across. Leaving this at its default</span>
<span class="sd">          value of None will search across all Shotgun data. </span>
<span class="sd">        </span>
<span class="sd">        * You need to define which subset of entity types to search using the </span>
<span class="sd">          entity_types parameter. Each of these entity types can be associated </span>
<span class="sd">          with a filter query to further reduce the list of matches. The filter</span>
<span class="sd">          list is using the standard filter syntax used by for example the </span>
<span class="sd">          find() method. For example: </span>
<span class="sd">          </span>
<span class="sd">          Constrain the search to all shots but character assets only::</span>
<span class="sd">              </span>
<span class="sd">              { &quot;Asset&quot;: [[&quot;sg_asset_type&quot;, &quot;is&quot;, &quot;character&quot;]], </span>
<span class="sd">                &quot;Shot&quot;:  []  </span>
<span class="sd">              }</span>
<span class="sd">          </span>
<span class="sd">        A dictionary with keys &#39;terms&#39; and &#39;matches&#39; will be returned::</span>
<span class="sd">        </span>
<span class="sd">            {&#39;matches&#39;: [{&#39;id&#39;: 734,</span>
<span class="sd">                          &#39;type&#39;: &#39;Asset&#39;,</span>
<span class="sd">                          &#39;name&#39;: &#39;Bunny&#39;,</span>
<span class="sd">                          &#39;project_id&#39;: 65,                      </span>
<span class="sd">                          &#39;image&#39;: &#39;https://...&#39;,</span>
<span class="sd">                          &#39;links&#39;: [&#39;&#39;, &#39;&#39;],</span>
<span class="sd">                          &#39;status&#39;: &#39;fin&#39;},</span>
<span class="sd">                          </span>
<span class="sd">                          {&#39;id&#39;: 558,</span>
<span class="sd">                           &#39;type&#39;: &#39;Task&#39;</span>
<span class="sd">                           &#39;name&#39;: &#39;FX&#39;,</span>
<span class="sd">                           &#39;project_id&#39;: 65,</span>
<span class="sd">                           &#39;image&#39;: &#39;https://...&#39;,</span>
<span class="sd">                           &#39;links&#39;: [&#39;Shot&#39;, &#39;bunny_010_0010&#39;],</span>
<span class="sd">                           &#39;status&#39;: &#39;fin&#39;}],</span>
<span class="sd">                &#39;terms&#39;: [&#39;bunny&#39;]}</span>
<span class="sd">        </span>
<span class="sd">        The links field will contain information about any linked entity. </span>
<span class="sd">        This is useful when for example presenting tasks and you want to </span>
<span class="sd">        display what shot or asset the task is associated with.</span>

<span class="sd">        :param text: Text to search for. This must be at least three </span>
<span class="sd">                     characters long, or an exception will be raised.</span>
<span class="sd">        </span>
<span class="sd">        :param entity_types: Dictionary to specify which entity types to search </span>
<span class="sd">                             across. See above for usage examples.</span>
<span class="sd">        </span>
<span class="sd">        :param project_ids: List of projects to search. By default, all </span>
<span class="sd">                            projects will be searched. </span>
<span class="sd">        </span>
<span class="sd">        :param limit: Specify the maximum number of matches to return.</span>
<span class="sd">        </span>
<span class="sd">        :returns: A complex dictonary structure, see above for example.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;auto_complete requires server version 6.2.0 or &quot;</span>\
                    <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>
        
        <span class="c"># convert entity_types structure into the form </span>
        <span class="c"># that the API endpoint expects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity_types</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;entity_types parameter must be a dictionary&quot;</span><span class="p">)</span>
        
        <span class="n">api_entity_types</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">filter_list</span><span class="p">)</span> <span class="ow">in</span> <span class="n">entity_types</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">resolved_filters</span> <span class="o">=</span> <span class="n">_translate_filters</span><span class="p">(</span><span class="n">filter_list</span><span class="p">,</span> <span class="n">filter_operator</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
                <span class="n">api_entity_types</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolved_filters</span>      
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;value of entity_types[&#39;</span><span class="si">%s</span><span class="s">&#39;] must &quot;</span>
                                 <span class="s">&quot;be a list or tuple.&quot;</span> <span class="o">%</span> <span class="n">entity_type</span><span class="p">)</span>
            
        <span class="n">project_ids</span> <span class="o">=</span> <span class="n">project_ids</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span> 
                   <span class="s">&quot;entity_types&quot;</span><span class="p">:</span> <span class="n">api_entity_types</span><span class="p">,</span>
                   <span class="s">&quot;project_ids&quot;</span><span class="p">:</span> <span class="n">project_ids</span><span class="p">,</span>
                   <span class="s">&quot;max_results&quot;</span><span class="p">:</span> <span class="n">limit</span> <span class="p">}</span>

        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;query_display_name_cache&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="Shotgun.activity_stream_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.activity_stream_read">[docs]</a>    <span class="k">def</span> <span class="nf">activity_stream_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">entity_fields</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                             <span class="n">min_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves activity stream data from Shotgun.</span>
<span class="sd">        </span>
<span class="sd">        This data corresponds to the data that is displayed in the </span>
<span class="sd">        Activity tab for an entity in the Shotgun Web UI.</span>
<span class="sd">        </span>
<span class="sd">        A complex data structure on the following form will be </span>
<span class="sd">        returned from Shotgun::</span>
<span class="sd">        </span>
<span class="sd">            {&#39;earliest_update_id&#39;: 50,</span>
<span class="sd">             &#39;entity_id&#39;: 65,</span>
<span class="sd">             &#39;entity_type&#39;: &#39;Project&#39;,</span>
<span class="sd">             &#39;latest_update_id&#39;: 79,</span>
<span class="sd">             &#39;updates&#39;: [{&#39;created_at&#39;: &#39;2015-07-15 11:06:55 UTC&#39;,</span>
<span class="sd">                          &#39;created_by&#39;: {&#39;id&#39;: 38,</span>
<span class="sd">                                         &#39;image&#39;: &#39;6641&#39;,</span>
<span class="sd">                                         &#39;name&#39;: &#39;John Smith&#39;,</span>
<span class="sd">                                         &#39;status&#39;: &#39;act&#39;,</span>
<span class="sd">                                         &#39;type&#39;: &#39;HumanUser&#39;},</span>
<span class="sd">                          &#39;id&#39;: 79,</span>
<span class="sd">                          &#39;meta&#39;: {&#39;entity_id&#39;: 6004,</span>
<span class="sd">                                   &#39;entity_type&#39;: &#39;Version&#39;,</span>
<span class="sd">                                   &#39;type&#39;: &#39;new_entity&#39;},</span>
<span class="sd">                          &#39;primary_entity&#39;: {&#39;id&#39;: 6004,</span>
<span class="sd">                                             &#39;name&#39;: &#39;Review_turntable_v2&#39;,</span>
<span class="sd">                                             &#39;status&#39;: &#39;rev&#39;,</span>
<span class="sd">                                             &#39;type&#39;: &#39;Version&#39;},</span>
<span class="sd">                          &#39;read&#39;: False,</span>
<span class="sd">                          &#39;update_type&#39;: &#39;create&#39;},</span>
<span class="sd">                         {...},</span>
<span class="sd">                        ]    </span>
<span class="sd">            }</span>
<span class="sd">        </span>
<span class="sd">        The main payload of the return data can be found inside the &#39;updates&#39; </span>
<span class="sd">        key, containing a list of dictionaries. This list is always returned </span>
<span class="sd">        in descending date order. Each item may contain different fields </span>
<span class="sd">        depending on their update type. The primary_entity key represents the </span>
<span class="sd">        main Shotgun entity that is associated with the update. By default, </span>
<span class="sd">        this entity is returned with a set of standard fields. By using the </span>
<span class="sd">        entity_fields parameter, you can extend the returned data to include </span>
<span class="sd">        additional fields. If for example you wanted to return the asset type </span>
<span class="sd">        for all assets and the linked sequence for all Shots, pass the </span>
<span class="sd">        following entity_fields::</span>
<span class="sd">        </span>
<span class="sd">            {&quot;Shot&quot;: [&quot;sg_sequence&quot;], &quot;Asset&quot;: [&quot;sg_asset_type&quot;]}</span>
<span class="sd">        </span>
<span class="sd">        Deep queries can be used in this syntax if you want to </span>
<span class="sd">        traverse into connected data.</span>
<span class="sd">        </span>
<span class="sd">        :param entity_type: Entity type to retrieve activity stream for</span>
<span class="sd">        </span>
<span class="sd">        :param entity_id: Entity id to retrieve activity stream for</span>
<span class="sd">        </span>
<span class="sd">        :param entity_fields: List of additional fields to include. </span>
<span class="sd">                              See above for details</span>
<span class="sd">        </span>
<span class="sd">        :param max_id: Do not retrieve ids greater than this id. </span>
<span class="sd">                       This is useful when implementing paging.</span>
<span class="sd">        </span>
<span class="sd">        :param min_id: Do not retrieve ids lesser than this id. </span>
<span class="sd">                       This is useful when implementing caching of </span>
<span class="sd">                       the event stream data and you want to </span>
<span class="sd">                       &quot;top up&quot; an existing cache.</span>
<span class="sd">        </span>
<span class="sd">        :param limit: Limit the number of returned records. If not specified, </span>
<span class="sd">                      the system default will be used.</span>

<span class="sd">        :returns: A complex activity stream data structure. See above for details </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;activity_stream requires server version 6.2.0 or &quot;</span>\
                    <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="c"># set up parameters to send to server.</span>
        <span class="n">entity_fields</span> <span class="o">=</span> <span class="n">entity_fields</span> <span class="ow">or</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity_fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;entity_fields parameter must be a dictionary&quot;</span><span class="p">)</span>
        
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
                   <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="n">entity_id</span><span class="p">,</span>
                   <span class="s">&quot;max_id&quot;</span><span class="p">:</span> <span class="n">max_id</span><span class="p">,</span>
                   <span class="s">&quot;min_id&quot;</span><span class="p">:</span> <span class="n">min_id</span><span class="p">,</span>
                   <span class="s">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                   <span class="s">&quot;entity_fields&quot;</span><span class="p">:</span> <span class="n">entity_fields</span> <span class="p">}</span>

        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;activity_stream&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="Shotgun.get_session_token"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.get_session_token">[docs]</a>    <span class="k">def</span> <span class="nf">get_session_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the session token associated with the current session.</span>
<span class="sd">        If a session token has already been established, this is returned, </span>
<span class="sd">        otherwise a new one is generated on the server and returned.</span>
<span class="sd">        </span>
<span class="sd">        :returns: String containing a session token</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span>

        <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s">&quot;get_session_token&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">session_token</span> <span class="o">=</span> <span class="p">(</span><span class="n">rv</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;session_id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">session_token</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Could not extract session_id from </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span> <span class="o">=</span> <span class="n">session_token</span>

        <span class="k">return</span> <span class="n">session_token</span>
</div>
    <span class="k">def</span> <span class="nf">_build_opener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build urllib2 opener with appropriate proxy handler.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_handler</span><span class="p">:</span>
            <span class="n">opener</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_handler</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opener</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">opener</span>

    <span class="c"># Deprecated methods from old wrapper</span>
    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Deprecated: use schema_field_read(&#39;type&#39;:&#39;</span><span class="si">%s</span><span class="s">&#39;) &quot;</span>
            <span class="s">&quot;instead&quot;</span> <span class="o">%</span> <span class="n">entity_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">entity_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Deprecated: use schema_entity_read() instead&quot;</span><span class="p">)</span>
    <span class="c"># ========================================================================</span>
    <span class="c"># RPC Functions</span>

    <span class="k">def</span> <span class="nf">_call_rpc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">include_auth_params</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls the specified method on the Shotgun Server sending the</span>
<span class="sd">        supplied payload.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Starting rpc call to </span><span class="si">%s</span><span class="s"> with params </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_outbound</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_payload</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span>
            <span class="n">include_auth_params</span><span class="o">=</span><span class="n">include_auth_params</span><span class="p">)</span>
        <span class="n">encoded_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

        <span class="n">req_headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;content-type&quot;</span> <span class="p">:</span> <span class="s">&quot;application/json; charset=utf-8&quot;</span><span class="p">,</span>
            <span class="s">&quot;connection&quot;</span> <span class="p">:</span> <span class="s">&quot;keep-alive&quot;</span>
        <span class="p">}</span>
        <span class="n">http_status</span><span class="p">,</span> <span class="n">resp_headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_call</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">api_path</span><span class="p">,</span> <span class="n">encoded_payload</span><span class="p">,</span> <span class="n">req_headers</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Completed rpc call to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_http_status</span><span class="p">(</span><span class="n">http_status</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ProtocolError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">resp_headers</span>
            <span class="c"># 403 is returned with custom error page when api access is blocked</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errcode</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
                <span class="n">e</span><span class="o">.</span><span class="n">errmsg</span> <span class="o">+=</span> <span class="s">&quot;: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">body</span>
            <span class="k">raise</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_response</span><span class="p">(</span><span class="n">resp_headers</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_response_errors</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_inbound</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&quot;results&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;results&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">first</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_auth_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return a dictionary of the authentication parameters being used. &quot;&quot;&quot;</span>
                
        <span class="c"># Used to authenticate HumanUser credentials</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span><span class="p">:</span>
            <span class="n">auth_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;user_login&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span><span class="p">),</span>
                <span class="s">&quot;user_password&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span><span class="p">:</span>
                <span class="n">auth_params</span><span class="p">[</span><span class="s">&quot;auth_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span><span class="p">)</span>

        <span class="c"># Use script name instead</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">script_name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">api_key</span><span class="p">:</span>
            <span class="n">auth_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;script_name&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">script_name</span><span class="p">),</span>
                <span class="s">&quot;script_key&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">api_key</span><span class="p">),</span>
            <span class="p">}</span>

        <span class="c"># Authenticate using session_id</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Session token based authentication requires server version 5.3.0 or &quot;</span>\
                    <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>
            
            <span class="n">auth_params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;session_token&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span><span class="p">)}</span>

            <span class="c"># Request server side to raise exception for expired sessions. </span>
            <span class="c"># This was added in as part of Shotgun 5.4.4            </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">auth_params</span><span class="p">[</span><span class="s">&quot;reject_if_expired&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;invalid auth params&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_uuid</span><span class="p">:</span>
            <span class="n">auth_params</span><span class="p">[</span><span class="s">&quot;session_uuid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_uuid</span>

        <span class="c"># Make sure sudo_as_login is supported by server version</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sudo_as_login</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Option &#39;sudo_as_login&#39; requires server version 5.3.12 or &quot;</span>\
                    <span class="s">&quot;higher, server is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>
            <span class="n">auth_params</span><span class="p">[</span><span class="s">&quot;sudo_as_login&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sudo_as_login</span>

        <span class="k">return</span> <span class="n">auth_params</span>

    <span class="k">def</span> <span class="nf">_sanitize_auth_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given an authentication parameter dictionary, sanitize any sensitive</span>
<span class="sd">        information and return the sanitized dict copy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sanitized_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;user_password&#39;</span><span class="p">,</span> <span class="s">&#39;script_key&#39;</span><span class="p">,</span> <span class="s">&#39;session_token&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sanitized_params</span><span class="p">:</span>
                <span class="n">sanitized_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;********&#39;</span>
        <span class="k">return</span> <span class="n">sanitized_params</span>

    <span class="k">def</span> <span class="nf">_build_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">include_auth_params</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Builds the payload to be send to the rpc endpoint.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">method</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;method is empty&quot;</span><span class="p">)</span>

        <span class="n">call_params</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">include_auth_params</span><span class="p">:</span>
            <span class="n">auth_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_params</span><span class="p">()</span>
            <span class="n">call_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auth_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">call_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&quot;method_name&quot;</span> <span class="p">:</span> <span class="n">method</span><span class="p">,</span>
            <span class="s">&quot;params&quot;</span> <span class="p">:</span> <span class="n">call_params</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_encode_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Encodes the payload to a string to be passed to the rpc endpoint.</span>

<span class="sd">        The payload is json encoded as a unicode string if the content</span>
<span class="sd">        requires it. The unicode string is then encoded as &#39;utf-8&#39; as it must</span>
<span class="sd">        be in a single byte encoding to go over the wire.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">wire</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wire</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">wire</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wire</span>

    <span class="k">def</span> <span class="nf">_make_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes a HTTP call to the server, handles retry and failure.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">req_headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;user-agent&quot;</span><span class="p">:</span> <span class="s">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_agents</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">authorization</span><span class="p">:</span>
            <span class="n">req_headers</span><span class="p">[</span><span class="s">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">authorization</span>

        <span class="n">req_headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="ow">or</span> <span class="bp">None</span>

        <span class="n">max_rpc_attempts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_rpc_attempts</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_rpc_attempts</span><span class="p">):</span>
            <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_request</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">req_headers</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c">#TODO: LOG ?</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_close_connection</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_rpc_attempts</span><span class="p">:</span>
                    <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_http_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes the actual HTTP request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
            <span class="n">path</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Request is </span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">verb</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Request headers are </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">headers</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Request body is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">body</span><span class="p">)</span>

        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_connection</span><span class="p">()</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="c">#http response code is handled else where</span>
        <span class="n">http_status</span> <span class="o">=</span> <span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
        <span class="n">resp_headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">resp_body</span> <span class="o">=</span> <span class="n">content</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Response status is </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">http_status</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Response headers are </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">resp_headers</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Response body is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">resp_body</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">http_status</span><span class="p">,</span> <span class="n">resp_headers</span><span class="p">,</span> <span class="n">resp_body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_http_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the status returned from the http request.</span>

<span class="sd">        :raises: RuntimeError if the http status is non success.</span>

<span class="sd">        :param status: Tuple of (code, reason).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">error_code</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">errmsg</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="s">&quot;HTTP error from server&quot;</span>
            <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">503</span><span class="p">:</span>
                <span class="n">errmsg</span> <span class="o">=</span> <span class="s">&quot;Shotgun is currently down for maintenance or too busy to reply. Please try again later.&quot;</span>
            <span class="k">raise</span> <span class="n">ProtocolError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                                <span class="n">error_code</span><span class="p">,</span>
                                <span class="n">errmsg</span><span class="p">,</span>
                                <span class="n">headers</span><span class="p">)</span>

        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_decode_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Decodes the response from the server from the wire format to</span>
<span class="sd">        a python data structure.</span>

<span class="sd">        :param headers: Headers from the server.</span>

<span class="sd">        :param body: Raw response body from the server.</span>

<span class="sd">        :returns: If the content-type starts with application/json or</span>
<span class="sd">            text/javascript the body is json decoded. Otherwise the raw body is</span>
<span class="sd">            returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">body</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">body</span>

        <span class="n">ct</span> <span class="o">=</span> <span class="p">(</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;content-type&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&quot;application/json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ct</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ct</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;text/javascript&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">body</span>

    <span class="k">def</span> <span class="nf">_json_loads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_json_loads_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;See http://stackoverflow.com/questions/956867&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">_decode_list</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
            <span class="n">newlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">_decode_list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">newlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">newlist</span>

        <span class="k">def</span> <span class="nf">_decode_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">):</span>
            <span class="n">newdict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">_decode_list</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">newdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">return</span> <span class="n">newdict</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">_decode_dict</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_response_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sg_response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raises any API errors specified in the response.</span>

<span class="sd">        :raises ShotgunError: If the server response contains an exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ERR_AUTH</span> <span class="o">=</span> <span class="mi">102</span> <span class="c"># error code for authentication related problems</span>
        <span class="n">ERR_2FA</span>  <span class="o">=</span> <span class="mi">106</span> <span class="c"># error code when 2FA authentication is required but no 2FA token provided.</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sg_response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;exception&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;error_code&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">ERR_AUTH</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AuthenticationFault</span><span class="p">(</span><span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;Unknown Authentication Error&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;error_code&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">ERR_2FA</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MissingTwoFactorAuthenticationFault</span><span class="p">(</span><span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;Unknown 2FA Authentication Error&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># raise general Fault            </span>
                <span class="k">raise</span> <span class="n">Fault</span><span class="p">(</span><span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;Unknown Error&quot;</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_visit_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Walk the data (simple python types) and call the visitor.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>

        <span class="n">recursive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visit_data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">recursive</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">visitor</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">recursive</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">visitor</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">recursive</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">visitor</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">visitor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_transform_outbound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transforms data types or values before they are sent by the</span>
<span class="sd">        client.</span>

<span class="sd">        * changes timezones</span>
<span class="sd">        * converts dates and times to strings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">convert_datetimes_to_utc</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">_change_tz</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">SG_TIMEZONE</span><span class="o">.</span><span class="n">local</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">SG_TIMEZONE</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_change_tz</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">local_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">_outbound_visitor</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">_change_tz</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">_change_tz</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%SZ&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                <span class="c">#existing code did not tz transform dates.</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">local_now</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
                    <span class="n">minute</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">second</span><span class="p">,</span>
                    <span class="n">microsecond</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">microsecond</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_change_tz</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">_change_tz</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%SZ&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c"># Convert strings to unicode</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visit_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_outbound_visitor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_transform_inbound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transforms data types or values after they are received from the</span>
<span class="sd">        server.&quot;&quot;&quot;</span>
        <span class="c">#NOTE: The time zone is removed from the time after it is transformed</span>
        <span class="c">#to the local time, otherwise it will fail to compare to datetimes</span>
        <span class="c">#that do not have a time zone.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">convert_datetimes_to_utc</span><span class="p">:</span>
            <span class="n">_change_tz</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">SG_TIMEZONE</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">SG_TIMEZONE</span><span class="o">.</span><span class="n">local</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_change_tz</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">def</span> <span class="nf">_inbound_visitor</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">20</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DATE_TIME_PATTERN</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c"># strptime was not on datetime in python2.4</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span>
                            <span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%SZ&quot;</span><span class="p">)[:</span><span class="mi">6</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">value</span>
                    <span class="k">if</span> <span class="n">_change_tz</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">_change_tz</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">value</span>

            <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visit_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_inbound_visitor</span><span class="p">)</span>

    <span class="c"># ========================================================================</span>
    <span class="c"># Connection Functions</span>

    <span class="k">def</span> <span class="nf">_get_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the current connection or creates a new connection to the</span>
<span class="sd">        current server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_server</span><span class="p">:</span>
            <span class="n">pi</span> <span class="o">=</span> <span class="n">ProxyInfo</span><span class="p">(</span><span class="n">socks</span><span class="o">.</span><span class="n">PROXY_TYPE_HTTP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_server</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_port</span><span class="p">,</span> <span class="n">proxy_user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_user</span><span class="p">,</span>
                 <span class="n">proxy_pass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_pass</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">Http</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeout_secs</span><span class="p">,</span> <span class="n">ca_certs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span><span class="p">,</span>
                <span class="n">proxy_info</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span> <span class="n">disable_ssl_certificate_validation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_ssl_validation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">Http</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeout_secs</span><span class="p">,</span> <span class="n">ca_certs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span><span class="p">,</span>
                <span class="n">proxy_info</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">disable_ssl_certificate_validation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_ssl_validation</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>

    <span class="k">def</span> <span class="nf">_close_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes the current connection.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">conn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span>
    <span class="c"># ========================================================================</span>
    <span class="c"># Utility</span>

    <span class="k">def</span> <span class="nf">_parse_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parses &#39;records&#39; returned from the api to do local modifications:</span>

<span class="sd">        * Insert thumbnail urls</span>
<span class="sd">        * Insert local file paths.</span>
<span class="sd">        * Revert &amp;lt; html entities that may be the result of input sanitization</span>
<span class="sd">          mechanisms back to a litteral &lt; character.</span>

<span class="sd">        :param records: List of records (dicts) to process or a single record.</span>

<span class="sd">        :returns: A list of the records processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">records</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">records</span> <span class="o">=</span> <span class="p">[</span><span class="n">records</span><span class="p">,</span> <span class="p">]</span>

        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
            <span class="c"># skip results that aren&#39;t entity dictionaries</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c"># iterate over each item and check each field for possible injection</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rec</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c"># Check for html entities in strings</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">StringTypes</span><span class="p">):</span>
                    <span class="n">rec</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;lt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">)</span>

                <span class="c"># check for thumbnail for older version (&lt;3.3.0) of shotgun</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&#39;image&#39;</span> <span class="ow">and</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">rec</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_thumb_url</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span>
                        <span class="n">rec</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;link_type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;local&#39;</span> \
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">local_path_field</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">local_path</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">local_path_field</span><span class="p">]</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&#39;local_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_path</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;file://</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">local_path</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span><span class="p">,)</span>

        <span class="k">return</span> <span class="n">records</span>

    <span class="k">def</span> <span class="nf">_build_thumb_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the URL for the thumbnail of an entity given the</span>
<span class="sd">        entity type and the entity id.</span>

<span class="sd">        Note: This makes a call to the server for every thumbnail.</span>

<span class="sd">        :param entity_type: Entity type the id is for.</span>
<span class="sd">        </span>
<span class="sd">        :param entity_id: id of the entity to get the thumbnail for.</span>

<span class="sd">        :returns: Fully qualified url to the thumbnail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Example response from the end point</span>
        <span class="c"># curl &quot;https://foo.com/upload/get_thumbnail_url?entity_type=Version&amp;entity_id=1&quot;</span>
        <span class="c"># 1</span>
        <span class="c"># /files/0000/0000/0012/232/shot_thumb.jpg.jpg</span>
        <span class="n">entity_info</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;e_type&#39;</span><span class="p">:</span><span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">entity_type</span><span class="p">),</span>
                       <span class="s">&#39;e_id&#39;</span><span class="p">:</span><span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entity_id</span><span class="p">))}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;/upload/get_thumbnail_url?&quot;</span> <span class="o">+</span>
                <span class="s">&quot;entity_type=</span><span class="si">%(e_type)s</span><span class="s">&amp;entity_id=</span><span class="si">%(e_id)s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">entity_info</span><span class="p">)</span>

        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_call</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">code</span><span class="p">,</span> <span class="n">thumb_url</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

        <span class="c">#code of 0 means error, second line is the error code</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="n">thumb_url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">thumb_url</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

        <span class="c"># Comments in prev version said we can get this sometimes.</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Unknown code </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">thumb_url</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_dict_to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">key_name</span><span class="o">=</span><span class="s">&quot;field_name&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s">&quot;value&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility function to convert a dict into a list dicts using the</span>
<span class="sd">        key_name and value_name keys.</span>

<span class="sd">        e.g. d {&#39;foo&#39; : &#39;bar&#39;} changed to [{&#39;field_name&#39;:&#39;foo, &#39;value&#39;:&#39;bar&#39;}]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="p">{</span><span class="n">key_name</span> <span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="n">value_name</span> <span class="p">:</span> <span class="n">v</span> <span class="p">}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">d</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
        <span class="p">]</span>


<span class="c"># Helpers from the previous API, left as is.</span>

<span class="c"># Based on http://code.activestate.com/recipes/146306/</span></div>
<span class="k">class</span> <span class="nc">FormPostHandler</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handler for multipart form data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">handler_order</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPHandler</span><span class="o">.</span><span class="n">handler_order</span> <span class="o">-</span> <span class="mi">10</span> <span class="c"># needs to run first</span>

    <span class="k">def</span> <span class="nf">http_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">file</span><span class="p">):</span>
                    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span> <span class="c"># sequencing on</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">boundary</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
                <span class="n">content_type</span> <span class="o">=</span> <span class="s">&#39;multipart/form-data; boundary=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">boundary</span>
                <span class="n">request</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request</span>

    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">buffer</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">boundary</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="n">mimetools</span><span class="o">.</span><span class="n">choose_boundary</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">buffer</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">buffer</span> <span class="o">=</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="nb">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;--</span><span class="si">%s</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">)</span>
            <span class="nb">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Content-Disposition: form-data; name=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
            <span class="nb">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n\r\n</span><span class="si">%s</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">content_type</span> <span class="ow">or</span> <span class="s">&#39;application/octet-stream&#39;</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fstat</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">fileno</span><span class="p">())[</span><span class="n">stat</span><span class="o">.</span><span class="n">ST_SIZE</span><span class="p">]</span>
            <span class="nb">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;--</span><span class="si">%s</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">)</span>
            <span class="n">c_dis</span> <span class="o">=</span> <span class="s">&#39;Content-Disposition: form-data; name=&quot;</span><span class="si">%s</span><span class="s">&quot;; filename=&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&#39;</span>
            <span class="n">content_disposition</span> <span class="o">=</span> <span class="n">c_dis</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="nb">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content_disposition</span><span class="p">)</span>
            <span class="nb">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Content-Type: </span><span class="si">%s</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">content_type</span><span class="p">)</span>
            <span class="nb">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Content-Length: </span><span class="si">%s</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">file_size</span><span class="p">)</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="nb">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="si">%s</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="nb">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;--</span><span class="si">%s</span><span class="s">--</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">)</span>
        <span class="nb">buffer</span> <span class="o">=</span> <span class="nb">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">boundary</span><span class="p">,</span> <span class="nb">buffer</span>

    <span class="k">def</span> <span class="nf">https_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_translate_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">filter_operator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;_translate_filters translates filters params into data structure</span>
<span class="sd">    expected by rpc call.&quot;&quot;&quot;</span>
    <span class="n">wrapped_filters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;filter_operator&quot;</span><span class="p">:</span> <span class="n">filter_operator</span> <span class="ow">or</span> <span class="s">&quot;all&quot;</span><span class="p">,</span>
        <span class="s">&quot;filters&quot;</span><span class="p">:</span> <span class="n">filters</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">_translate_filters_dict</span><span class="p">(</span><span class="n">wrapped_filters</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_translate_filters_dict</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">):</span>
    <span class="n">new_filters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">filter_operator</span> <span class="o">=</span> <span class="n">sg_filter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;filter_operator&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">filter_operator</span> <span class="o">==</span> <span class="s">&quot;all&quot;</span> <span class="ow">or</span> <span class="n">filter_operator</span> <span class="o">==</span> <span class="s">&quot;and&quot;</span><span class="p">:</span>
        <span class="n">new_filters</span><span class="p">[</span><span class="s">&quot;logical_operator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;and&quot;</span>
    <span class="k">elif</span> <span class="n">filter_operator</span> <span class="o">==</span> <span class="s">&quot;any&quot;</span> <span class="ow">or</span> <span class="n">filter_operator</span> <span class="o">==</span> <span class="s">&quot;or&quot;</span><span class="p">:</span>
        <span class="n">new_filters</span><span class="p">[</span><span class="s">&quot;logical_operator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;or&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Invalid filter_operator </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">filter_operator</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">[</span><span class="s">&quot;filters&quot;</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Invalid filters, expected a list or a tuple, got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sg_filter</span><span class="p">[</span><span class="s">&quot;filters&quot;</span><span class="p">])</span>
        
    <span class="n">new_filters</span><span class="p">[</span><span class="s">&quot;conditions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_translate_filters_list</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">[</span><span class="s">&quot;filters&quot;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">new_filters</span>
    
<span class="k">def</span> <span class="nf">_translate_filters_list</span><span class="p">(</span><span class="n">filters</span><span class="p">):</span>
    <span class="n">conditions</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">sg_filter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_translate_filters_simple</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_translate_filters_dict</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s">&quot;Invalid filters, expected a list, tuple or dict, got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sg_filter</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">conditions</span>

<span class="k">def</span> <span class="nf">_translate_filters_simple</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">):</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;path&quot;</span><span class="p">:</span> <span class="n">sg_filter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s">&quot;relation&quot;</span><span class="p">:</span> <span class="n">sg_filter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="n">values</span> <span class="o">=</span> <span class="n">sg_filter</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">condition</span><span class="p">[</span><span class="s">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

    <span class="k">return</span> <span class="n">condition</span>

<span class="k">def</span> <span class="nf">_version_str</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts a tuple of int&#39;s to a &#39;.&#39; separated str&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
    
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Autodesk.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'sphinx',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>